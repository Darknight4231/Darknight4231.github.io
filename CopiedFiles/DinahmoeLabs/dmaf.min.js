!function(){function a(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)d.call(this,b[c])}function b(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c)}if(!("undefined"==typeof window||"undefined"==typeof window.Element||"classList"in document.documentElement)){var c=Array.prototype,d=c.push,e=c.splice,f=c.join;a.prototype={add:function(a){this.contains(a)||(d.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!==this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!==a;b++);e.call(this,b,1),this.el.className=this.toString()}},toString:function(){return f.call(this," ")},toggle:function(a){return this.contains(a)?this.remove(a):this.add(a),this.contains(a)}},window.DOMTokenList=a,b(Element.prototype,"classList",function(){return new a(this)})}}(),function(a,b){"use strict";function c(a){return o[n]=d.apply(b,a),n++}function d(a){var c=[].slice.call(arguments,1);return function(){"function"==typeof a?a.apply(b,c):new Function(""+a)()}}function e(a){if(p)setTimeout(d(e,a),0);else{var b=o[a];if(b){p=!0;try{b()}finally{f(a),p=!1}}}}function f(a){delete o[a]}function g(){m=function(){var a=c(arguments);return process.nextTick(d(e,a)),a}}function h(){if(a.postMessage&&!a.importScripts){var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b}}function i(){var b="setImmediate$"+Math.random()+"$",d=function(c){c.source===a&&"string"==typeof c.data&&0===c.data.indexOf(b)&&e(+c.data.slice(b.length))};a.addEventListener?a.addEventListener("message",d,!1):a.attachEvent("onmessage",d),m=function(){var d=c(arguments);return a.postMessage(b+d,"*"),d}}function j(){var a=new MessageChannel;a.port1.onmessage=function(a){var b=a.data;e(b)},m=function(){var b=c(arguments);return a.port2.postMessage(b),b}}function k(){var a=q.documentElement;m=function(){var b=c(arguments),d=q.createElement("script");return d.onreadystatechange=function(){e(b),d.onreadystatechange=null,a.removeChild(d),d=null},a.appendChild(d),b}}function l(){m=function(){var a=c(arguments);return setTimeout(d(e,a),0),a}}if(!a.setImmediate){var m,n=1,o={},p=!1,q=a.document,r=Object.getPrototypeOf&&Object.getPrototypeOf(a);r=r&&r.setTimeout?r:a,"[object process]"==={}.toString.call(a.process)?g():h()?i():a.MessageChannel?j():q&&"onreadystatechange"in q.createElement("script")?k():l(),r.setImmediate=m,r.clearImmediate=f}}(new Function("return this")()),function(){function a(){}"undefined"!=typeof window&&(Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if("function"!=typeof c)throw new TypeError("Function.prototype.bind called on incompatible "+c);for(var d=Array.prototype.slice.call(arguments,1),e=function(){if(this instanceof i){var a=c.apply(this,d.concat(Array.prototype.slice.call(arguments)));return Object(a)===a?a:this}return c.apply(b,d.concat(Array.prototype.slice.call(arguments)))},f=Math.max(0,c.length-d.length),g=[],h=0;f>h;h++)g.push("$"+h);var i=new Function("binder","return function("+g.join(",")+"){return binder.apply(this,arguments)}")(e);return c.prototype&&(a.prototype=c.prototype,i.prototype=new a,a.prototype=null),i}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length;e>d;d++)c[d]=a.call(b,this[d],d,this);return c}),Date.now||(Date.now=function(){return(new Date).getTime()}),navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),function(a,b){for(var c,d,e=["webkit","moz","ms","o"],f=0,g=e.shift();!a[b]&&g;)a[b]=a[g+"RequestAnimationFrame"],a.cancelAnimationFrame=a[g+"CancelAnimationFrame"]||a[g+"CancelRequestAnimationFrame"],g=e.shift();window.requestAnimationFrame||(window.requestAnimationFrame=function(a){function b(){a(c+d)}return c=Date.now(),d=Math.max(0,16-(c-f)),f=c+d,setTimeout(b,d)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(window,"requestAnimationFrame"))}(),function(a){function b(a,c,d){var e=typeof d,i=typeof c,j=typeof a;return"string"===j?c instanceof Array&&"function"===e?(h.registered[a]=d,d.deps=c):"function"===i?(h.registered[a]=c,c.deps=g(c)):"undefined"!==i&&(h.modules[a]=c):"function"===j&&(h.registered[f(a)]=a,a.deps=g(a)),b}function c(a,b){b.apply(null,a.map(d))}function d(a){return h.modules[a]||e(a)}function e(a){var b=h.registered[a];return b&&(h.modules[a]=b.apply(null,b.deps.map(d)),delete h.registered[a]),h.modules[a]}function f(a){var b;if("string"==typeof a.name)return a.name;if(b=j.exec(a),b&&b[1])return b[1];throw new TypeError("Cannot parse function name!")}function g(a){var b=i.exec(a),c=b&&b[1]&&b[1].replace(/\s/g,"");return c=c||null,c?c.split(/,/):[]}var h={registered:{},modules:{}},i=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,j=/function\s*([^\s\(]+)/;"function"==typeof define?define(b):"undefined"!=typeof module&&module.exports&&(module.exports=b),b.core=h,b("core",h),h.require=d,b.init=c,a.dmaf=b}("undefined"==typeof window?global:window),dmaf("env",["_"],function a(b){function c(){if(a.xhr=b.isFunction(window.XMLHttpRequest),a.xhr2=a.xhr&&"responseType"in new XMLHttpRequest,a.xdr="XDomainRequest"in window,a.arraybuffer=b.isFunction(window.ArrayBuffer),a.webaudio=b.isFunction(window.webkitAudioContext)||b.isFunction(window.AudioContext),a.touch="createTouch"in document,a.audioElement=b.isFunction(document.createElement("audio").canPlayType),a.webSockets=b.isFunction(window.WebSocket),a.speechToText="webkitSpeechRecognition"in window||"SpeechRecognition"in window,a.textToSpeech="speechSynthesis"in window,a.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia),a.flash=!!navigator.plugins["Shockwave Flash"],!a.flash)try{a.flash=!!new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(c){a.flash="undefined"!=typeof navigator.mimeTypes["application/x-shockwave-flash"]}a.ok=a.audioElement&&a.xhr}function d(){var c=[{ext:".ogg",test:'audio/ogg; codecs="vorbis"'},{ext:".aac",test:'audio/mp4; codecs="mp4a.40.2"'},{ext:".mp4",test:"audio/mp4;"}],d=[{ext:".mp4",test:"video/mp4;"},{ext:".webm",test:"video/webm;"}],f=b.find(e,c,document.createElement("audio"));a.audioFormat=f?f.ext:"",a.audioType=f?f.test:"",a.webaudio||(a.audioFormat=".mp4",a.audioType="audio/mp4;"),f=b.find(e,d,document.createElement("video")),a.videoFormat=f?f.ext:"",a.videoType=f?f.test:""}function e(a){return this.canPlayType(a.test).replace(/^no$/,"")&&a}function f(a,b){var c=a.match(b);return c&&c.length>1&&c[1]||""}function g(){var c,d="undefined"!=typeof navigator?navigator.userAgent:"",e=f.curry(d),g=e(/(ipod|iphone|ipad)/i).toLowerCase(),h=/like android/i.test(d),i=!h&&/android/i.test(d),j=e(/version\/(\d+(\.\d+)?)/i),k=/tablet/i.test(d),l=!k&&/[^-]mobi/i.test(d),m=!0;/opera|opr/i.test(d)?c={name:"Opera",opera:m,version:j||e(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(d)?c={name:"Windows Phone",windowsphone:m,msie:m,version:e(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(d)?c={name:"Internet Explorer",msie:m,version:e(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(d)?c={name:"Chrome",chrome:m,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:g?(c={name:"iphone"===g?"iPhone":"ipad"===g?"iPad":"iPod"},j&&(c.version=j)):/sailfish/i.test(d)?c={name:"Sailfish",sailfish:m,version:e(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(d)?c={name:"SeaMonkey",seamonkey:m,version:e(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(d)?(c={name:"Firefox",firefox:m,version:e(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(d)&&(c.firefoxos=m)):/silk/i.test(d)?c={name:"Amazon Silk",silk:m,version:e(/silk\/(\d+(\.\d+)?)/i)}:i?c={name:"Android",version:j}:/phantom/i.test(d)?c={name:"PhantomJS",phantom:m,version:e(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(d)||/rim\stablet/i.test(d)?c={name:"BlackBerry",blackberry:m,version:j||e(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(d)?(c={name:"WebOS",webos:m,version:j||e(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(d)&&(c.touchpad=m)):c=/bada/i.test(d)?{name:"Bada",bada:m,version:e(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(d)?{name:"Tizen",tizen:m,version:e(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||j}:/safari/i.test(d)?{name:"Safari",safari:m,version:j}:{},/(apple)?webkit/i.test(d)?(c.name=c.name||"Webkit",c.webkit=m,!c.version&&j&&(c.version=j)):!c.opera&&/gecko\//i.test(d)&&(c.name=c.name||"Gecko",c.gecko=m,c.version=c.version||e(/gecko\/(\d+(\.\d+)?)/i)),i||c.silk?(c.android=m,c.OS="android"):g&&(c[g]=m,c.ios=m,c.OS="ios"),/Mac OS X/i.test(d)?(c.OS=c.OS||"osx",c.osx=m):(c.OS=c.OS||"windows","windows"===c.OS&&(c.windows=m));var n="";g?(n=e(/os (\d+([_\s]\d+)*) like mac os x/i),n=n.replace(/[_\s]/g,".")):i?n=e(/android[ \/-](\d+(\.\d+)*)/i):c.windowsphone?n=e(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):c.webos?n=e(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):c.blackberry?n=e(/rim\stablet\sos\s(\d+(\.\d+)*)/i):c.bada?n=e(/bada\/(\d+(\.\d+)*)/i):c.tizen&&(n=e(/tizen[\/\s](\d+(\.\d+)*)/i)),n&&(c.osversion=n),n.split(".")[0],k||"ipad"===g||i&&!l||c.silk?c.tablet=m:(l||"iphone"===g||"ipod"===g||i||c.blackberry||c.webos||c.bada)&&(c.mobile=m),c.tablet||(c.tablet=!1),c.mobile||(c.mobile=!1),c.desktop=!c.mobile&&!c.tablet,c.device=c.desktop?"desktop":c.mobile?"mobile":c.tablet?"tablet":"unknown",c.browser=(c.name?c.name.toLowerCase():"").replace(/\s/,"_"),b.extend(a,c)}var a={};return"undefined"!=typeof window&&window.navigator&&window.document?(a.web=!0,g(),c(),d()):a.web=!1,a}),dmaf("events",["core"],function b(a){function c(b){var c,e,f,g,h;if(b&&"string"==typeof b){for(f=o,o=!1,e=m,m=b,c=d(b),h=0,g=c.length;!o&&g>h;h++)c[h].apply(this,arguments);o=f,m=e}return a}function d(a){var b,c,d,e=a.split(n),f=l,g=[];for(d=0,c=e.length;c>d&&(b=f.names&&f.names[e[d]]);d++)b.listeners&&k.apply(g,b.listeners),f=f.names[e[d]];return g}function e(){o=!0}function f(a,b){var c,d,e,g=l;if(!Array.isArray(a)){for(c=a.split(n),e=0,d=c.length;d>e;e++)g=g.names,g.hasOwnProperty(c[e])&&"undefined"!=typeof g[c[e]]||(g[c[e]]={names:{}}),g=g[c[e]];for(g.listeners=g.listeners||[],e=0,d=g.listeners.length;d>e;e++)if(g.listeners[e]===b)return b;return g.listeners.push(b),b}for(e=0,d=a.length;d>e;e++)f(a[e],b)}function g(a,b){function c(){return h(a,c),b.apply(this,arguments)}return f(a,c)}function h(b,c){var d,e,f,g;if(0===arguments.length)return void(a._events=l={names:{}});for(d=b.split(n),e=l,g=0,f=d.length;f>g;g++)e=e.names&&e.names[d[g]];c?(g=e.listeners.indexOf(c),g>-1&&e.listeners.splice(g,1)):i(e)}function i(a){var b,c,d=Object.keys(a.names);for(delete a.listeners,c=0,b=d.length;b>c;c++)i(a.names[d[c]])}function j(){return m}var k=Array.prototype.push,l={names:{}},m="",n=/:/,o=!1;return a.addEventListener=a.on=f,a.removeEventListener=a.off=h,a.getListeners=d,a.getCurrentEvent=j,a.stopEvents=e,a.once=g,a.dispatch=c,a._events=l,b}),dmaf("_",[],function c(){function a(a){var b=c.slice(arguments,1);return function(){return a.apply(this,b.concat(c.slice(arguments)))}}function b(d,e){return e=e||d.length,function(){return arguments.length<e?e-arguments.length>0?b(a.apply(this,[d].concat(c.slice(arguments))),e-arguments.length):a.apply(this,[d].concat(c.slice(arguments))):d.apply(this,arguments)}}function d(a,b,d){for(var e=b.length,f=c["break"],g=-1;++g<e&&a.call(d,b[g],g,b)!==f;);}function e(a,b,d){for(var e=Object.keys(b),f=e.length,g=c["break"],h=-1;++h<f&&a.call(d,b[e[h]],e[h],b)!==g;);}function f(a,b,f){a&&b&&(Array.isArray(b)?d(a,b,f):c.isObject(b)?e(a,b,f):d(a,c.toArray(b),f))}function g(a){return{key:a,value:this[a]}}function h(a,b,c,d){this.type=a||"noteOn",this.midiNote=b||0,this.velocity=c||0,this.duration=d||0}function i(a,b){this.index=-1,this.array=a,this.getNext=l[b],this.A=a.slice(0),this.B=[]}var c={},j=Object.prototype.toString,k={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},unescape:{"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"}};c.comma=/,/,c.colon=/:/,c.dot=/\./,c.plus=/\+/,c.bang=/\!/,c.separator=/[\:\.]/,c.whiteSpace=/\s+/g,c.accidental=/#|b/,c.digit=/-?\d/,c.cssUnit=/\%|px/,c.dynamic=/<%\=\s([a-zA-Z\.0-9\_\/]*)\s%>/,c.extension=/\.[a-z]{3,4}$/,c.directory=/[a-zA-Z0-9]+\/$/,c.args=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,c.E="",c.NOTES={C:0,D:2,E:4,F:5,G:7,A:9,B:11},c.ACCIDENTALS={"#":1,b:-1},c.SCALES={off:null,major:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0],majorTriad:[0,-1,-2,1,0,-1,1,0,-1,-2,2,1],minorTriad:[0,-1,-2,0,-1,-2,1,0,-1,-2,2,1],harmonicMinor:[0,1,0,0,-1,0,1,0,0,-1,1,0],naturalMinor:[0,-1,0,0,-1,0,-1,0,0,-1,0,-1],majorPentatonic:[0,1,0,1,0,-1,1,0,1,0,-1,1],minorPentatonic:[0,-1,1,0,-1,0,1,0,-1,1,0,-1],dorian:[0,1,0,0,-1,0,1,0,1,0,0,-1],phrygian:[0,0,-1,0,-1,0,1,0,0,-1,0,-1],lydian:[0,1,0,1,0,1,0,0,1,0,1,0],mixolydian:[0,1,0,1,0,0,-1,0,-1,0,-1],locrian:[0,0,-1,0,-1,0,0,-1,0,-1,0,-1],doubleHarmonic:[0,0,-1,1,0,0,1,0,0,-1,1,0],halfDim:[0,1,0,0,-1,0,0,-1,0,-1,0,-1],pentatonic:[0,-1,-2,0,-1,0,-1,0,-1,-2,0,-1]},c.VENDOR_PREFIXES=["webkit","o","ms","moz"],c.CSS_PREFIXES=["-ms-","-webkit-","-moz-","-o-"],c.demethodize=Function.prototype.bind.bind(Function.prototype.call),c.slice=c.demethodize(Array.prototype.slice),c["break"]={},Function.prototype.autocurry=function(a){return b(this,a)},Function.prototype.curry=function(){var a=this,b=c.slice(arguments);return function(){return a.apply(this,b.concat(c.slice(arguments)))}},Function.prototype.reverse=function(){return c.flipF(this)},c.curry=a,c.autocurry=b,c.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length;c;)b=[a[--c].apply(this,b)];return b[0]}},c.noop=function(){},c.identity=function(a){return a},c.truthy=function(a){return!!a},c.falsy=function(a){return!a},c.add=c.concat=function(a,b){return a+b}.autocurry(),c.append=function(a,b){return b+a}.autocurry(),c.subtract=function(a,b){return a-b}.autocurry(),c.prop=function(a,b){return c.get(b,a)}.autocurry(),c.is=c["=="]=function(a,b){return a===b}.autocurry(),c.isnt=c["!="]=function(a,b){return a!==b}.autocurry(),c.lessThan=c["<"]=function(a,b){return b>a}.autocurry(),c.greaterThan=c[">"]=function(a,b){return a>b}.autocurry(),c.lessThanOrEqualTo=c.lte=c["<="]=function(a,b){return b>=a}.autocurry(),c.greaterThanOrEqualTo=c.gte=c[">="]=function(a,b){return a>=b}.autocurry(),c.propIs=function(a,b,c){return c[a]===b}.autocurry(),c.propIsnt=function(a,b,c){return c[a]!==b}.autocurry(),c.call=function(a){return a.call(this)},c.callWith=function(){var a=c.slice(arguments);return function(b){return b.apply(this,a)}},c.memoize=function(a,b){var d={};return b=b||c.identity,function(){var c=b.apply(this,arguments);return"undefined"==typeof d[c]&&(d[c]=a.apply(this,arguments)),d[c]}},c.throttle=function(a,b,c){var d=-1;return function(){var e=Date.now();return e-d>b?(d=e,a.apply(c,arguments)):void 0}},c.debounce=function(a,b,d){function e(){return a.apply(d,g.concat(c.slice(h)))}var f,g=c.slice(arguments,3),h=[];return function(){clearTimeout(f),h=arguments,f=setTimeout(e,b)}},c.onlyOnce=function(a){var b=!1;return function(){return b?null:(b=!0)&&a.apply(this,arguments)}},c.change=function(a){function b(){var b=JSON.stringify(arguments);return b!==d?(d=b,a.apply(this,arguments)):void 0}var d=c.UID();return b.reset=function(){d=c.UID()},b},c.flipF=function(a){return function(){return a.apply(this,c.slice(arguments).reverse())}},c.after=function(a,b){var d=c.slice(arguments,2),e=0;return function(){return++e>=a&&b.apply(this,c.flatten(d,c.slice(arguments)))}},c.forEach=c.each=f.autocurry(2),c.map=function(a,b,d){var e;if(d=d||b,c.isArray(b)){e=[];for(var f=0,g=b.length;g>f;f++)e[f]=a.call(d,b[f],f,b)}else c.isObject(b)&&(e={},Object.keys(b).forEach(function(c){e[c]=a.call(d,b[c],c,b)}));return e}.autocurry(2),c.filter=function(a,b,d){var e;if(d=d||b,c.isArray(b)){e=[];for(var f=0,g=b.length;g>f;f++)a.call(d,b[f],f,b)&&e.push(b[f])}else c.isObject(b)&&(e={},Object.keys(b).forEach(function(c){a.call(d,b[c],c,b)&&(e[c]=b[c])}));return e}.autocurry(2),c.reduce=function(a,b,c){var d=-1,e=b.length,g=arguments.length<3;if("number"==typeof e)for(g&&(c=b[++d]);++d<e;)c=a(c,b[d],d,b);else f(function(d,e){c=g?(g=!1,d):a(c,d,e,b)},b);return c}.autocurry(2),c.every=function(a,b,d){var e=!0;return f(function(b,f,g){return a.call(d,b,f,g)?void 0:(e=!1,c["break"])},b),e}.autocurry(2),c.some=function(a,b,d){var e=!1;return f(function(b,f,g){return a.call(d,b,f,g)?(e=!0,c["break"]):void 0},b),e}.autocurry(2),c.reverse=function(a){for(var b,c,d=0,e=a.length;e/2>d;d++)b=e-1-d,c=a[d],a[d]=a[b],a[b]=c;return a},c.sort=function(a,b){return b.sort(a)}.autocurry(),c.sortBy=function(a,b,c){var d=b?-1:1,e=b?1:-1;return c.sort(function(b,c){return b[a]<c[a]?d:e})}.autocurry(),c.first=function(a){return a[0]}.autocurry(),c.last=function(a){return a[a.length-1]}.autocurry(),c.max=function(a){return Math.max.apply(Math,a)},c.min=function(a){return Math.min.apply(Math,a)},c.find=function(a,b,d){var e;return c.each(function(f,g){return a.call(d,f,g,b)?(e=f,c["break"]):void 0},b),e}.autocurry(2),c.partition=function(a,b,c){for(var d=[],e=[],f=0,g=b.length;g>f;f++)a.call(c,b[f],f,b)?d.push(b[f]):e.push(b[f]);return[d,e]}.autocurry(2),c.partitionBy=function(a,b){for(var c={},d=0,e=b.length;e>d;d++)c[b[d][a]]=c[b[d][a]]||[],c[b[d][a]].push(b[d]);return c}.autocurry(2),c.compact=function(a){return a.filter(c.truthy)},c.union=function(){return c.unique(c.flatten.apply(c,arguments))},c.unique=function(a){return a.filter(c.uniq)},c.where=function(a,b){return c.filter(c.matches(a),b)}.autocurry(2),c.findWhere=function(a,b){return c.find(c.matches(b),a)}.autocurry(),c.swap=function(a,b,c){var d=a[b];return a[b]=a[c],a[c]=d,a}.autocurry(3),c.average=function(a){return a.reduce(c.add)/a.length},c.contains=function(a,b){return-1!==a.indexOf(b)}.autocurry(),c.join=function(a){return arguments.length>1&&(a=c.slice(arguments)),[].concat.apply([],a)},c.flatten=function(){var a=[];return f(function b(d){c.isArray(d)?c.forEach(b,d):a.push(d)},c.slice(arguments)),a},c.pluck=function(a,b){return c.map(c.prop(a),b)}.autocurry(),c.mapToObj=c.map(function(a,b){return{index:b,value:a}}),c.uniq=function(a,b,c){return c.indexOf(a)===b},c.stringSort=function(a){return function(b,c){return b[a]<c[a]?-1:1}},c.propSort=function(a){return function(b,c){return b[a]-c[a]}},c.from=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=b?b(d,c):void 0;return c},c.onemap=function(a,b){for(var d=c.slice(a),e=0,f=a.length;f>e;e++)d[e]=b(a[e]);return d},c.diff=function(a,b){return a.filter(function(a){return-1===b.indexOf(a)})},c.indexBy=function(a,b){return b.reduce(function(b,c){return b[c[a]]=c,b},{})}.autocurry(),c.rmItem=function(a,b){var c=b.indexOf(a);return c>-1&&b.splice(c,1),b},c.constrain=function(a,b){return b>a.max&&(b=a.max),b<a.min&&(b=a.min),b},c.inRange=function(a,b){return b<=a.max&&b>=a.min},c.rand=function(a,b){var c;return arguments.length?("undefined"==typeof b&&(b=a,a=0),c=b-a-1e-4,parseInt(Math.random()*c)+a):Math.random()>=.5},c.test=function(a,b){return a=c.isRegExp(a)?a:new RegExp(a),a.test(b)}.autocurry(),c.firstMatch=function(a,b){var d;return b?(c.isRegExp(b)&&(b=a,a=b),"function"!=typeof b.match?d="":(d=b.match(a),d=d&&d.length>1&&d[1]||"")):d="",d}.autocurry(),c.nameToPath=function(a,b,c){return a+c+b}.autocurry(),c.noWhiteSpace=function(a){return c.isString(a)?a.replace(c.whiteSpace,""):a},c.joinArgs=function(a){return c.slice(arguments,1).join(a)}.autocurry(2),c.bool=function(a){return"true"===a?!0:"false"===a?!1:a},c.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},c.split=function(a,b){return b.split(a)}.autocurry(),c.replace=function(a,b,c){return c.replace(a,b)}.autocurry(),c.toString=function(a){return a?a.toString():""},c.convert=function(a,b){if(c.isUndefined(b))return b;switch(c.get(a,"type")){case"int":return parseFloat(b);case"float":return parseFloat(b);case"string":return isNaN(b)||""===b?b+"":parseFloat(b);case"list":return c.isArray(b)?b:b.split(",").map(c.noWhiteSpace);case"enum":return b+"";case"boolean":return"true"===b;case"array":return b;case void 0:console.error("Missing/Malformed descriptor",a,b);break;default:console.error("Unknown Type",a,b)}},c.coerce=function(a){if(!isNaN(parseFloat(a)))return parseFloat(a);if("string"==typeof a){if(a=a.toLowerCase().trim(),"true"===a)return!0;if("false"===a)return!1}return a},c.validate=function(a,b){switch(c.get(a,"type")){case"int":return c.isInt(b)&&c.inRange(a,b);case"float":return c.isFloat(b)&&c.inRange(a,b);case"string":return c.isString(b);case"list":return c.isArray(b)&&c.compact(c.filter(c.isString,b)).length===b.length;case"enum":return c.contains(a.values,b);case"boolean":return c.isBoolean(b);case"array":return c.isArray(b);case void 0:console.error("Missing/Malformed descriptor",a,b);break;default:console.error("Unknown Type",a,b)}}.autocurry(),c["default"]=function(a,b){return f(function(a,d){b[d]=c.isUndefined(b[d])?a:b[d]},a),b},c.isValidJSON=function(a){return"string"!=typeof a?!1:/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))},c.keys=function(a){return c.isObject(a)?Object.keys(a):[]},c.has=function(a,b){return b.hasOwnProperty(a)},c.set=function(a,b,d){var e,f;if(!c.isTraversable(a))return null;for(e=c.isArray(b)?b.slice():b.split(c.separator),f=e.shift();e.length;)a=c.isInt(parseFloat(e[0]))?"undefined"==typeof a[f]?a[f]=[]:a[f]:"undefined"==typeof a[f]?a[f]={}:a[f],f=e.shift();return a[f]=d,d}.autocurry(3),c.get=function(a,b){var d,e;if("object"==typeof a){for(d=c.isArray(b)?b.slice():b.split(c.separator),e=d.shift();d.length;){if(!a[e])return a[e];a=a[e],e=d.shift()}if(!d.length&&"undefined"!==a[e])return a[e]}return void 0}.autocurry(2),c.recurse=function(a,b,d){function e(g,h){a(g,h,b,f.concat([h])),c.isTraversable(g)&&(f.push(h),g!==b&&c.forEach(e,g,d),f.pop())}var f=[];c.isTraversable(b)&&c.forEach(e,b,d)}.autocurry(2),c.extend=function(a){return f(function(b){f(function(b,d){c.isObject(b)?c.extend(a[d]={},b):c.isArray(b)?c.extend(a[d]=[],b):a[d]=b},b)},c.slice(arguments,1)),a},c.clone=function(a){return JSON.parse(JSON.stringify(a))},c.toObj=function(a,b){var c={};return c[a]=b,c}.autocurry(2),c.toArray=function(a){return a&&"number"==typeof a.length?c.slice(a):c.isObject(a)?c.map(g,a):[]},c.sortObj=function(a){function b(b,d){return b[d]=c.isObject(a[d])?c.sortObj(a[d]):a[d],b}return Object.keys(a).sort().reduce(b,{})},c.invoke=function(a){var b=c.slice(arguments,1),d=c.isFunction(a);return function(c){return(d?a:c[a]).apply(c,b)}},c.bindMethod=function(a,b,c){return c?(b[a]=b[a].bind(b),b[a]):b[a].bind(b)},c.bindAll=function(a){for(var b in a)c.isFunction(a[b])&&(a[b]=a[b].bind(a))},c.matches=function(a,b){if(!b)return!1;for(var c in a)if(a[c]!==b[c])return!1;return!0}.autocurry(2),c.setImmediate=c.nextTick=function(a){setTimeout(a.apply.bind(a,this,c.slice(arguments,1)),0)},c.dbToWAVolume=function(a){return Math.max(0,Math.floor(100*Math.pow(2,a/6))/100)},c.dbToJSVolume=function(a){return Math.min(1,c.dbToWAVolume(a))},c.toMidiNote=function(a){var b,d,e,f;if("number"==typeof a)f=a;else{if(a=a.replace(/s/,"#"),b=c.NOTES[a[0]],d=c.accidental.exec(a),e=c.digit.exec(a),d=d&&d[0],e=e&&parseInt(e[0]),"undefined"==typeof b)throw new Error("pitchClass was undefined "+a);if(d&&(b=(b+c.ACCIDENTALS[d]+12)%12),"undefined"==typeof e)throw new Error("Malformed note string "+a);f=24+b+12*e}return f},c.mToF=function(a){return 8.1757989156*Math.pow(2,a/12)},c.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))},c.sign=function(a){return 0===a?1:Math.abs(a)/a},c.fmod=function(a,b){var c,d,e=0,f=0,g=0,h=0;return c=a.toExponential().match(/^.\.?(.*)e(.+)$/),e=parseInt(c[2],10)-(c[1]+"").length,c=b.toExponential().match(/^.\.?(.*)e(.+)$/),f=parseInt(c[2],10)-(c[1]+"").length,f>e&&(e=f),d=a%b,-100>e||e>20?(g=Math.round(Math.log(d)/Math.log(10)),h=Math.pow(10,g),(d/h).toFixed(g-e)*h):parseFloat(d.toFixed(-e))},c.scaleQuantize=function(a,b,d){var e,f;return e=c.isArray(a)?a:c.SCALES[a],e?(b=c.toMidiNote(b+"-2"),f=d%12-b,0>f&&(f=12+f),d+e[f]):null},c.makeNote=function(a,b,c,d){return new h(a,b,c,d)},c.toKeys=function(a){return c.isArray(a)?a.slice():c.isString(a)?a.split(c.separator):[]},c.isInt=function(a){return a===+a&&a%1===0},c.isFloat=function(a){return a===+a&&isFinite(a)},c.isNumber=function(a){return"number"==typeof a},c.isDefined=function(a){return"undefined"!=typeof a},c.isUndefined=function(a){return"undefined"==typeof a},c.isNull=function(a){return null===a},c.isBoolean=function(a){return"boolean"==typeof a},c.isString=function(a){return"string"==typeof a},c.isPrimitive=function(a){var b=typeof a;return"number"===b||"string"===b||"boolean"===b||null===a||void 0===a},c.isArray=function(a){return Array.isArray(a)},c.isFunction=function(a){return"function"==typeof a||/Function|Constructor/.test(j.call(a))},c.isObject=function(a){return"[object Object]"===j.call(a)},c.isRegExp=function(a){return a instanceof RegExp},c.isDate=function(a){return a instanceof Date},c.isArguments=function(a){return!(!a||!c.has(a,"callee"))},c.isDynamic=function(a){return c.isString(a)&&/<%\=\s([a-zA-Z\.0-9\_\/]*)\s%>/g.test(a)},c.isNested=function(a){return c.isArray(a)?a.every(c.isString):c.isString(a)&&/[\w]+\./.test(a)},c.isExtendable=function(a){return a===Object(a)},c.isElement=c.isNode=function(a){return!(!a||1!==a.nodeType)},c.isHTML=function(a){return/^\s*<(\w+|!)[^>]*>/.test(a)},c.isNodeList=function(a){return"undefined"!=typeof NodeList&&a instanceof window.NodeList},c.isFilePath=function(a){return!!a&&c.extension.test(a)},c.isDirectoryPath=function(a){return!!a&&c.diretory.test(a)},c.isTraversable=function(a){return!!a&&(c.isArray(a)||c.isObject(a))},c.UID=c.uid=function(a){var b="0123456789ABCDEF",c="";a=a||16;for(var d=0;a>d;d++)c+=b.substr(~~(16*Math.random()),1);return c};var l={ROUND_ROBIN:function(){return this.index++,this.index%=this.array.length,this.array[this.index]},RANDOM_FIRST:function(){return this.index=-1===this.index?Math.floor(Math.random()*this.array.length):(this.index+1)%this.array.length,this.array[this.index]},RANDOM:function(){return this.array[Math.floor(Math.random()*this.array.length)]},SHUFFLE:function(){var a=c.rand(this.A.length),b=this.A.splice(a,1).pop();return this.B.push(b),this.B.length===this.array.length&&(this.A=this.array.slice(0),this.B=[]),b}};c.iterator=function(a,b){return new i(a,b)},c.vendorPrefix=function(a,b){var d=c.capitalize(b);return c.VENDOR_PREFIXES.map(function(b){return a[b+d]}).filter(c.truthy).shift()||a[b]||null},c.prefixCSS=function(a,b,d){return c.CSS_PREFIXES.forEach(function(c){a[c+b]=d}),a},c.decodeEntities=function(a){var b=document.createElement("p");return b.innerHTML=a,b.innerText||b.textContent},c.utcDate=function(){var a=new Date,b=a.getUTCMonth()+1,c=[a.getUTCDate(),(10>b?"0":"")+b,a.getFullYear().toString().replace(/20/,"")];return c.join("_")};var m={escape:new RegExp("["+c.keys(k.escape).join("")+"]","g"),unescape:new RegExp("("+c.keys(k.unescape).join("|")+")","g")};return f(function(a){c[a]=function(b){return b?(""+b).replace(m[a],function(b){return k[a][b]}):""}},["escape","unescape"]),c}),dmaf("task",["_","core"],function d(a,b){function c(b){if(!a.isFunction(b))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");this._subscribers=[],e(b,this)}function e(a,b){function c(a){j(b,a)}function d(a){l(b,a)}try{a(c,d)}catch(e){d(e)}}function f(b,c,d,e){var f,g,h,k,m=a.isFunction(d);if(m)try{h=d(e),f=!0}catch(n){g=!0,k=n}else h=e,f=!0;i(c,h)||(m&&f?j(c,h):g?l(c,k):b===q?j(c,h):b===r&&l(c,h))}function g(a,b,c,d){var e=a._subscribers,f=e.length;b._context=a._context,e[f]=b,e[f+q]=c,e[f+r]=d}function h(a,b){for(var c,d,e=a._subscribers,g=a._detail,h=0;h<e.length;h+=3)d=e[h],c=e[h+b],f(b,d,c,g);a._subscribers=null}function i(b,c){var d,e=null;try{if(b===c)throw new TypeError("A promise callback cannot return that same promise.");if(a.isExtendable(c))return e=c.then,a.isFunction(e)?(e.call(c,function(a){return d?!0:(d=!0,void(c!==a?j(b,a):k(b,a)))},function(a){return d?!0:(d=!0,void l(b,a))}),!0):!1}catch(f){return d||l(b,f),!0}}function j(a,b){a===b?k(a,b):i(a,b)||k(a,b)}function k(a,b){a._state===o&&(a._state=p,a._detail=b,setImmediate(m,a))}function l(a,b){a._state===o&&(a._state=p,a._detail=b,setImmediate(n,a))}function m(a){h(a,a._state=q)}function n(a){h(a,a._state=r)}function d(a){return new c(a)}var o=void 0,p=0,q=1,r=2;return c.prototype={constructor:c,_context:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(b,c){function d(){f(e._state,i,h[e._state-1],e._detail)}var e=this,h=arguments,i=new this.constructor(a.noop);return this._context&&b&&(b=b.bind(this._context),i._context=this.context),c&&(c=c.bind(this._context)),this._state?setImmediate(d):g(this,i,b,c),i},"catch":function(a){return this.then(null,a)},"finally":function(b){function d(a){return f.then(function(){return b(null,a),a})}function e(a){return f.then(function(){throw b(a),a})}var f=new c(a.noop);return f._context=this._context,this.then(d,e)},bind:function(b){return this._context=b,this.then(a.indentity)},or:function(b){return this["catch"](function(){return b instanceof b?b:a.isFunction(b)?d.resolve().then(b):void 0})},resolveWithEvent:function(a){function c(a,b,c){h=!0,c=c||{},c.eventName=a,c.eventTime=b,g=c,i.resolve(c)}function e(){return i.promise}function f(c){b.off(a,j),i.reject(c)}var g,h=!1,i=d.deferred(),j=b.once(a,c);return i.promise.bind(this._context),this.then(e,f)},reject:function(a){return this.then(function(){throw a})},delay:function(a){return this.then(function(){var b=d.deferred();return b.promise.bind(this._context),setTimeout(function(){b.resolve(a)},a),b.promise})}},d.Promise=c,d.resolve=function(a){function b(b){b(a)}return d(b)},d.reject=function(a){function b(b,c){c(a)}return d(b)},d.all=function(b){function c(c,d){function e(a){return function(b){f(a,b)}}function f(a,b){h[a]=b,0===--i&&c(h)}var g,h=[],i=b.length;0===i&&c([]);for(var j=0;j<b.length;j++)g=b[j],g&&a.isFunction(g.then)?g.then(e(j),d):f(j,g)}if(!a.isArray(b))throw new TypeError("You must pass an array to all.");return d(c)},d.race=function(b){function c(a,c){for(var d,e=0;e<b.length;e++)d=b[e],d&&"function"==typeof d.then?d.then(a,c):a(d)}return b=a.isArray(b)?b:a.slice(arguments),d(c)},d.deferred=function(a){function b(a,b){e=a,f=b}function c(){return function(a,b){a?f(a):e(b)}}var e,f,g=d(b).bind(a);return{resolve:e,reject:f,promise:g,makeNodeResolver:c}},d.bind=function(a){return d.resolve().bind(a)},d.peek=function(a){return(this.log?this:console).log("task.peek",a),a},d.getStack=function(b){(this.error?this:console).error("\n"+(a.get(b,"stack")||b))},d.either=function(a){return{or:function(b){return d.race([a,b])}}},d.timeout=function(a){function b(){e.reject(new Error("timed out after "+a+"ms"))}function c(){clearTimeout(f)}var e=d.deferred(),f=setTimeout(b,a);return e.promise.clear=c,e.promise},d.delay=function(a){function b(){e.resolve(a)}function c(){clearTimeout(f)}var e=d.deferred(),f=setTimeout(b,a);return e.promise.clear=c,e.promise},d.event=function(a,c,e){function f(){return d(function(d,f){function g(a,b,c){/:fail/.test(a)?f(c):(c=c||{},c.eventName=a,c.eventTime=b,d(c))}b.once(c,g),a&&b.dispatch(a,0,e||{})})}return c||(c=a,a=void 0),a?f:f()},d.denodeify=function(b,c){var e=[];return function(){function f(){try{b.apply(c,e)}catch(a){g.reject(a)}}var g=d.deferred();return e=e.concat(a.slice(arguments)),e.push(g.makeNodeResolver()),setImmediate(f),g.promise}},d.thenify=function(b){return b=d.denodeify(b),function(){var c=a.slice(arguments);return function(){return b.apply(this,c)}}},d.lateBind=function(b,c){return function(){var c=a.slice(arguments),e=c.pop();return d.denodeify(e[b],e).apply(this,c);

}.autocurry(c||1)},d.fcall=function(b){var c=a.slice(arguments,1);return function(){return b.apply(c.concat(a.slice(arguments)))}},d}),dmaf("ajax",["_","env","task"],function(a,b,c){function d(){a.each(a.call,i),i=null}function e(b){b.onload=b.onerror=b.ontimeout=b.onabort=a.noop}function f(a,b){var c=document.createElement("script");return c.setAttribute("src",a),c.setAttribute("async",!0),c.setAttribute("charset","UTF-8"),c.setAttribute("type","text/javascript"),c.onload=c.onerror=b,c}function g(c,d,f,g,h,k,m,o){function p(f){return function(){var j="undefined"!=typeof this.status;if(j?j=this.status>=200&&this.status<300||304===this.status:q&&(j=!0),delete i[s],e(this),"error"===f||!j)return d("AJAX Error: "+c);if("abort"===f)return d("Request was aborted."),r.abort();if(!g){if(!a.isValidJSON(this.responseText))return d(null,this.response||this.responseText);g="json"}switch(g){case"document":var k;if(b.xhr2&&"object"==typeof this.response)k=this.response;else if("object"!=typeof this.responseXML||/html/.test(c))try{k=document.implementation.createHTMLDocument(""),k.body.innerHTML=this.responseText}catch(l){try{k=(new DOMParser).parseFromString(this.responseText,h)}catch(m){}}else k=this.responseXML;k?d(null,k):d("Missing or malformed response: "+c);break;case"json":"object"==typeof this.response?d(null,this.response):this.responseText?d(null,JSON.parse(this.responseText)):d("Missing responseText: "+c);break;case"arraybuffer":b.arraybuffer?this.response instanceof ArrayBuffer?d(null,this.response):d("Malformed arraybuffer response: "+c):d("Your browser doesn't support responseType arraybuffer: "+c);break;case"text":"string"==typeof this.responseText?d(null,this.responseText):d("Malformed Response: "+c);break;case"blob":}}}var q,r,s,t=!j.test(c)&&"."!==c[0];d=a.onlyOnce(d),"undefined"!=typeof i&&i||(i={},n=0);try{q=b.xdr&&t,"Explorer"===b.browser&&b.browserVersion>9&&(q=!1),r=q?new window.XDomainRequest:new XMLHttpRequest,q&&(r.onprogress=a.noop)}catch(u){d("Could not find transport: "+c)}if(r.open(f,c,!0),!q&&b.xhr2&&g&&"json"!==g&&(r.responseType=g),k&&"overrideMimeType"in r&&r.overrideMimeType(k),r.timeout=l,r.onload=p(),r.onerror=p("error"),r.ontimeout=p("error"),r.onabort=i[s=n++]=p("abort"),m&&!q)for(var v in m)m.hasOwnProperty(v)&&r.setRequestHeader(v,m[v]);try{return r.send(o||null),r}catch(w){d("Error sending reqest: "+c)}}function h(a){return a.value&&a.key?encodeURIComponent(a.key.replace(" ","+"))+"="+encodeURIComponent(a.value.toString().replace(" ","+")):""}var i,j,k,l=3e4,m={},n=0;b.web?(m={getScript:function(b,d){function g(a){switch(e(j),clearTimeout(i),document.head.removeChild(j),a=a||{type:"noenv"},a.type){case"load":h(null);break;case"error":h("404 (not found): "+b);break;default:h("Unknown Error: "+b)}}var h,i,j,k=c.deferred();return d=d||a.noop,h=function(a,b){a?k.reject(a):k.resolve(b),d(b)},j=f(b,g),document.head.appendChild(j),k.promise},getDocument:function(a,b){var c=/\.html/.test(a)?"text/html":/\.xml/.test(a)?"text/xml":"";return g(a,b,"GET","document",c)},getJSON:function(a,b){return g(a,b,"GET","json")},sendJSON:function(a,b,c){return g(a,b,"POST",null,null,null,{"Content-type":"application/json; charset=utf-8"},JSON.stringify(c))}.autocurry(),getArrayBuffer:function(a,b){return g(a,b,"GET","arraybuffer")},getMIDI:function(a,b){return g(a,b,"GET","text","text/plain","text/plain; charset=x-user-defined")},getImg:function(a,b){var c=new Image;return c.onload=function(){b(null,c)},c.onerror=function(a){b(a)},c.src=a,c},getText:function(a,b){return g(a,b,"GET","text","text/plain")},post:function(b,c,d,e){return g(c,d||a.noop,"POST",null,null,null,b,e)},encodeQuery:function(b){return a.isObject(b)?void a.toArray(b).map(h).join("&"):(dmaf.error("encodeQuery: Missing parameters"),"")},href:function(a){function b(a){return decodeURIComponent(a.replace(/\+/g," "))}for(var c=/(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g,a=window.location.href,d={},e=c.exec(a);e;)d[b(e[1])]=b(e[2]),e=c.exec(a);return d},xhr:g},j=new RegExp(location.hostname||location.host),k=document.head||document.querySelector("head"),i={},"ActiveXObject"in window&&window.addEventListener("unload",d)):m={getScript:function(a,b){require(a),b(null)},getJSON:function(a,b){var c=require(a);c?b(null,c):b("File not found")}},a.extend(a,m)}),dmaf("async",["_"],function e(a){function b(b){return function(){return b.apply(null,[e.each].concat(a.slice(arguments)))}}function c(b){return function(){return b.apply(null,[e.eachSeries].concat(a.slice(arguments)))}}function d(b,c,d,e){var f;a.isArray(c)?(f=[],c=a.mapToObj(c),b(c,function(a,b){d(a.value,function(c,d){f[a.index]=d,b(c)})},function(a){e(a,f)})):(f={},c=a.map(function(a,b){return{value:a,key:b}},c),b(c,function(a,b){d(a.value,function(c,d){f[a.key]=d,b(c)})},function(a){e(a,f)}))}function f(b,c,d){if(d=d||a.noop,a.isArray(c))b.map(c,function(b,c){b&&b(function(b){var d=a.slice(arguments,1);d.length<=1&&(d=d[0]),c.call(null,b,d)})},d);else{var e={};b.each(Object.keys(c),function(b,d){c[b](function(c){var f=a.slice(arguments,1);f.length<=1&&(f=f[0]),e[b]=f,d(c)})},function(a){d(a,e)})}}var e={each:function(b,c,d){var e=a.isArray(b)?b.length:Object.keys(b).length,f=0;d=d||a.noop,a.each(function(b){c(b,a.onlyOnce(function(b){return b?(d(b),void(d=a.noop)):++f>=e?d(null):null}))},b)},eachSeries:function(b,c,d){function e(){c(b[h?i:b[g[i]]],function(b){return b?(d(b),void(d=a.noop)):++i>=f?d(null):e()})}var f,g,h=a.isArray(b),i=0;h?f=b.length:(g=Object.keys(b),f=g.length),d=d||a.noop,e()},iterator:function(a){function b(c){function d(){return a.length&&a[c].apply(null,arguments),d.next()}return d.next=function(){return c<a.length-1?b(c+1):null},d}return b(0)},map:b(d),mapSeries:c(d),parallel:function(a,b){f({map:e.map,each:e.each},a,b)},series:function(b,c){if(c=c||a.noop,a.isArray(b))e.mapSeries(b,function(b,c){b&&b(function(b){var d=a.slice(arguments,1);d.length<=1&&(d=d[0]),c.call(null,b,d)})},c);else{var d={};e.eachSeries(Object.keys(b),function(c,e){b[c](function(b){var f=a.slice(arguments,1);f.length<=1&&(f=f[0]),d[c]=f,e(b)})},function(a){c(a,d)})}},waterfall:function(b,c){if(c=c||a.noop,!b||!b.length)return c();var d=function(b){return function(e){if(e)c.apply(null,arguments),c=a.noop;else{var f=a.slice(arguments,1),g=b.next();f.push(g?d(g):c),a.setImmediate(function(){b.apply(null,f)})}}};d(e.iterator(b))()}};return e}),dmaf("logs",["_","core","env"],function(a,b){function c(){return Date.now()-k}function d(){return j?j.current:c()}function e(){var b=a.slice(arguments),c=b.shift();console.log(d()+" "+c.replace(/log:/,"")+":"+b.join(" "))}function f(){if(l){var b=a.slice(arguments),c=b.shift();console.log.apply(console,a.flatten(d()+" "+c.replace(/log:/,"")+":",b))}}function g(){if(l){var b=a.slice(arguments),c=b.shift();console.error.apply(console,a.flatten(d()+" "+c+":",b))}}function h(a){b.addEventListener("log:"+a,f)}function i(c){return function(){b.dispatch.apply(null,[c].concat(a.slice(arguments)))}}var j,k=Date.now(),l=!1;try{console.log.apply(console,[]),l=!0}catch(m){}return l?(dmaf.log=f.curry("info"),dmaf.error=f.curry("error"),b.addEventListener("error",g)):(dmaf.log=e.curry("info"),dmaf.error=e.curry("error"),b.addEventListener("error",e)),b.once("init_routing",function(){j=b.require("time")}),{add:h,make:i,log:l?f:e,error:l?g:e}}),dmaf.init(["_","events","async","env","core","ajax","logs"],function(a,b,c,d,e){function f(b){dmaf.log("dmaf is runnning in a browser");var f=y||b;return dmaf.init=a.noop,dmaf.initPath?(dmaf.log("dmaf.initPath:",dmaf.initPath),dmaf.dev=!0,f=dmaf.initPath):dmaf.dev=f!==b,dmaf.dev?d.ok?(dmaf.log("environment is ok for dmaf to run"),e.projectPath=f,c.series([i,j,l,k,n,o],p),window.core=e):v("environment"):b?(e.assetsPath=f,dmaf.log("starting production init"),c.series([h,k,n,o],p)):(dmaf.log("production init failed"),v("missing_path")),dmaf}function g(b){dmaf.log("dmaf is running in node.js");var d=require("path");if(dmaf.init=a.noop,clearTimeout(y),b)dmaf.log("dmaf is running as a helper to grunt"),global._=a,global.core=e,dmaf("grunt",b),e.framework=b.config("dmaf"),e.projectPath=b.config("root"),e.assetsPath=d.join(e.projectPath,"assets/"),require(d.join(e.framework,"grunt/utils.js"))(b),a.readJSON(a.repo("./grunt/npmTasks.json")).forEach(b.loadNpmTasks),b.config("project.configs")?(b.file.expand(a.repo("project/grunt/config/*.js")).forEach(function(c){b.config(a.pathToName(c),require(c))}),b.loadTasks(a.repo("./project/grunt/tasks/"))):(b.file.expand(a.repo("./grunt/config/*.js")).forEach(function(c){b.config(a.pathToName(c),require(c))}),b.loadTasks(a.repo("./grunt/tasks/")),dmaf("raw_descriptors",a.readJSON(a.repo("src/json/descriptors.json"))),require(d.join(e.framework,"src/js/framework/interface/descriptors"))),dmaf.isReady=!0;else{dmaf.log("dmaf is running as a node app"),process.argv.forEach(function(a,b){2===b&&(e.projectPath=a)}),e.projectPath=e.projectPath||"../",dmaf.log("initializing with project path "+e.projectPath);var f=require(e.projectPath+"package.json");a.each(function(a,b){e.modules[b]=require(b)},f.dependencies),c.series([i,j,l,n,o],p)}return dmaf}function h(b){function c(c,d){return c?(console.error(c),b("missing_dmaf_data")):(a.extend(e,d),dmaf("raw_descriptors",e.descriptors),void b(null))}var d=e.assetsPath+"json/dmaf_data.json";dmaf.log("getting project data"),dmaf.dataPath&&(d=dmaf.dataPath),a.getJSON(d,c)}function i(b){function c(c,d){return c?(console.error(c),b("missing_dmaf_data")):(dmaf.log("got project.json"),a.extend(e,d),e.assetsPath=e.assetsPath||e.projectPath+"assets/",e.framework=e.domain&&!a.href().dmaf?new RegExp(e.domain,"i").test(window.location.href)?e.framework||e.projectPath+"dmaf/":"/framework/":e.framework||e.projectPath+"dmaf/",e.configs=e.configs.map(a.nameToPath(e.projectPath+"config/",".json")),e.index=e.scripts.map(a.nameToPath(e.projectPath+"scripts/",".js")),a.each(e.require("logs").add,e.logs),void b(null))}dmaf.log("getting project.json",e.projectPath+"project.json"),a.getJSON(e.projectPath+"project.json",c)}function j(b){function d(c,d){return c?b("missing_dmaf_data"):(dmaf("raw_descriptors",d.descriptors),e.index=a.map(a.add(e.framework),d.index).concat(e.index),dmaf.log("got desciptors.json"),void h())}function f(a,c){return a?b("missing_dmaf_data"):(dmaf.log("got configs"),e.configs=c,void h())}var g={descriptors:e.framework+"src/json/descriptors.json",index:e.framework+"src/js/framework/index.json"},h=a.after(2,b,null);c.map(g,a.getJSON,d),e.configs.length?c.map(e.configs,a.getJSON,f):h()}function k(a){var b;e.requirements?(b=e.requirements.filter(r),b.length!==e.requirements.length?(console.error("failed to pass all app requirements"),a("environment")):(dmaf.log("passed all app requirements"),a(null))):(dmaf.log("no app requirements to check, continuing..."),a(null))}function l(b){dmaf.log("getting scripts"),c.each(e.index,a.getScript,function(a){a?b("missing_dmaf_data"):(dmaf.log("got scripts"),m(),b(null))})}function m(){var a=e.require("time");a&&a.init()}function n(b){var c=a.compose(a.flatten,a.pluck("actions"),a.filter(q));e.actions=c(e.configs),a.each(e.require("actions").add,e.actions),a.each(e.require,e.scripts),dmaf.log("actions added"),b(null)}function o(a){function b(){dmaf.log("preloads done",f-d),clearTimeout(c),--d>0?c=setTimeout(g,45e3):(dmaf.log("preloads complete"),e.removeEventListener("_internal:preload_complete",b),a(null))}var c,d=e.getListeners("preload_assets").length,f=d,g=a.curry("timeout");dmaf.log("starting preloads"),d?(e.addEventListener("_internal:preload_complete",b),e.dispatch("preload_assets")):(dmaf.log("no preloads found"),a(null))}function p(a){return a?v(a):(dmaf.isReady=!0,dmaf.log("dmaf_ready"),e.dispatch("init_routing"),d.web&&(e.require("public").resolve("listeners"),e.require("public").resolve("input")),e.dispatch("dmaf_ready"),void e.dispatch("_external:dmaf_ready"))}function q(a){var b=!1;return b=a.requirements.length?a.requirements.every(r,a):!0,b?dmaf.log("Accepting config",a.name):dmaf.log("Rejecting config",a.name),b}function r(b){var c=a[b.operator](d[b.key],a.coerce(b.value));return c}function s(){for(var b=a.toArray(document.getElementsByTagName("script")),c="",d=0,e=b.length;e>d;d++)if(c=b[d].getAttribute("data-dmaf"))return c;return""}function t(b){a.set(e,["pending",b],[]),dmaf[b]=function(){return a.get(e.pending,b).push(arguments),dmaf}}function u(a){return d.ok=a(e),dmaf}function v(b){function c(){var c=e.require("public");c?(e.require("public").resolve("listeners"),e.dispatch("dmaf_fail",b)):a.each(function(c){a.isFunction(c[0])&&c[0](b)},e.pending.fail)}console.error("dmaf failed to initialize: "+b),"environment"===b&&(window.__env=d),"complete"===document.readyState?(dmaf.log("document ready, dispatching dmaf_fail"),c()):(dmaf.log("document was not ready yet, waiting for ready event to dispatch dmaf_fail"),document.addEventListener("ready",c))}function w(a){return"undefined"==typeof a?e.active:(a!==e.active&&(e.active=a,e.dispatch((a?"in":"")+"active")),dmaf)}function x(){var a=require("repl");global.core=e,global.repl=function(){a.start({prompt:"> ",input:process.stdin,output:process.stdout,global:!0})},e.load=function(a){return require(process.env.DMAF+a),e.require(a.replace(/.*\/(\w+)$/,"$1"))}}var y;d.web?(a.each(t,["tell","fail","once","ready","registerObject","addEventListener","unregisterObject","removeEventListener"]),dmaf.ok=u,dmaf.init=f,dmaf.active=w,y=a.href().dmaf||s(),y&&dmaf.init()):(dmaf.init=g,global.TEST?x():y=setTimeout(g,50)),dmaf.isReady=!1,e.active=!0}),dmaf("midiParser",["beatPattern","assetController","_","assets"],function(a,b,c,d){function e(a,b,c){this.absoluteTime=b+a.readVariableLengthInt();var d=a.read8BitInt();240===(240&d)?this.getMetaEvent(a,d):this.getChannelEvent(a,d,c)}function f(a){this.pointer=0,this.midiString=a}function g(a){f.call(this,a.split("").map(j).join("")),this.tracks=[],this.chunk={},this.lastEventType=0,this.getNextChunk("MThd").readHeader().getTracks()}function h(b){var c,d,e,f,h,j,k,l,m,n,o,p,q=new g(b),r=[];for(j=1,k=q.trackCount;k>j;j++){for(f=q.tracks[j],c=f[0].text.toLowerCase(),d=f[1].text.toLowerCase(),e=a.pattern(c,1),l=2,m=f.length;m>l;l++)if("noteOn"===f[l].subtype||"controller"===f[l].subtype){for(h=f[l],h.type=h.subtype,n=Math.floor(h.absoluteTime/q.beatLengthInTicks),o=Math.floor(h.absoluteTime-n*q.beatLengthInTicks),p=l;m>p&&!i(f[p],h);p++);e.addEvent(d,n+1,o+1,h)}else"controller"===f[l].subtype&&(h=f[l],h.type=h.subtype,n=Math.floor(h.absoluteTime/q.beatLengthInTicks),o=Math.floor(h.absoluteTime-n*q.beatLengthInTicks),e.addEvent(d,n+1,o+1,h));r.push(e)}return r}function i(a,b){var c=("noteOn"===a.subtype||"noteOff"===a.subtype)&&a.subtype;return c&&a.midiNote===b.midiNote?"noteOn"===c&&!a.velocity||"noteOff"===c?(b.duration=a.absoluteTime-b.absoluteTime,b.duration):void 0:!1}function j(a){return String.fromCharCode(255&a.charCodeAt(0))}return e.prototype={getMetaEvent:function(a,b){var c,d;if(255==b){switch(this.type="meta",d=a.read8BitInt(),c=a.readVariableLengthInt(),d){case 0:if(this.subtype="sequenceNumber",2!=c)return;return void(this.number=a.read16BitInt());case 1:return this.subtype="text",void(this.text=a.readTo(c));case 2:return this.subtype="copyrightNotice",void(this.text=a.readTo(c));case 3:return this.subtype="trackName",void(this.text=a.readTo(c));case 4:return this.subtype="instrumentName",void(this.text=a.readTo(c));case 5:return this.subtype="lyrics",void(this.text=a.readTo(c));case 6:return this.subtype="marker",void(this.text=a.readTo(c));case 7:return this.subtype="cuePoint",void(this.text=a.readTo(c));case 32:if(this.subtype="midiChannelPrefix",1!==c)return;return void(this.channel=a.read8BitInt());case 47:return void(this.subtype="endOfTrack");case 81:if(this.subtype="setTempo",3!=c)return;return void(this.microsecondsPerBeat=(a.read8BitInt()<<16)+(a.read8BitInt()<<8)+a.read8BitInt());case 84:if(this.subtype="smpteOffset",5!=c)return;var e=a.read8BitInt();return this.frameRate={0:24,32:25,64:29,96:30}[96&e],this.hour=31&e,this.min=a.read8BitInt(),this.sec=a.read8BitInt(),this.frame=a.read8BitInt(),void(this.subframe=a.read8BitInt());case 88:if(this.subtype="timeSignature",4!==c)return;return this.numerator=a.read8BitInt(),this.denominator=Math.pow(2,a.read8BitInt()),this.metronome=a.read8BitInt(),void(this.thirtyseconds=a.read8BitInt());case 89:if(this.subtype="keySignature",2!==c)return;return this.key=a.read8BitInt(),void(this.scale=a.read8BitInt());case 127:return this.subtype="sequencerSpecific",void(this.data=a.readTo(c));default:return this.subtype="unknown",void(this.data=a.readTo(c))}return void(this.data=a.readTo(c))}return 240==b?(this.type="sysEx",c=a.readVariableLengthInt(),void(this.data=a.readTo(c))):247==b?(this.type="dividedSysEx",c=a.readVariableLengthInt(),void(this.data=a.readTo(c))):(this.type="unknown",c=a.readVariableLengthInt(),this.data=a.readTo(c),dmaf.error("Midi Parsing: unknown MIDI event type byte of length "+c),void 0)},getChannelEvent:function(a,b,c){var d,e;switch(0===(128&b)?(e=b,b=c.lastEventType):(e=a.read8BitInt(),c.lastEventType=b),d=b>>4,this.channel=15&b,this.type="channel",d){case 8:this.subtype="noteOff",this.midiNote=e,this.velocity=a.read8BitInt();break;case 9:this.midiNote=e,this.velocity=a.read8BitInt(),this.subtype=0===this.velocity?"noteOff":"noteOn";break;case 10:this.subtype="noteAftertouch",this.midiNote=e,this.amount=a.read8BitInt();break;case 11:this.subtype="controller",this.controllerType=e,this.value=a.read8BitInt();break;case 12:this.subtype="programChange",this.programNumber=e;break;case 13:this.subtype="channelAftertouch",this.amount=e;break;case 14:this.subtype="pitchBend",this.value=e+(a.read8BitInt()<<7);break;default:this.subtype="unknown",dmaf.error("Midi Parsing: Unrecognised MIDI event type: "+d)}}},f.prototype={read32BitInt:function(){var a=(this.midiString.charCodeAt(this.pointer)<<24)+(this.midiString.charCodeAt(this.pointer+1)<<16)+(this.midiString.charCodeAt(this.pointer+2)<<8)+this.midiString.charCodeAt(this.pointer+3);return this.pointer+=4,a},read16BitInt:function(){var a=(this.midiString.charCodeAt(this.pointer)<<8)+this.midiString.charCodeAt(this.pointer+1);return this.pointer+=2,a},read8BitInt:function(){var a=this.midiString.charCodeAt(this.pointer);return this.pointer+=1,a},readTo:function(a){var b=this.midiString.substr(this.pointer,a);return this.pointer+=a,b},endOfFile:function(){return this.pointer>=this.midiString.length},readVariableLengthInt:function(){for(var a=0;;){var b=this.read8BitInt();if(!(128&b))return a+b;a+=127&b,a<<=7}}},g.prototype=Object.create(f.prototype,{readHeader:{value:function(){var a=new f(this.chunk.data);return this.formatType=a.read16BitInt(),this.trackCount=a.read16BitInt(),this.ticksPerBeat=a.read16BitInt(),32768&this.ticksPerBeat&&(this.ticksPerBeat=480),this.beatLengthInTicks=this.ticksPerBeat/4,this}},getTracks:{value:function(){for(var a,b,c,d=0,g=this.trackCount;g>d;d++)for(this.tracks[d]=[],b=0,this.getNextChunk("MTrk"),a=new f(this.chunk.data);!a.endOfFile();)c=new e(a,b,this),this.tracks[d].push(c),b=c.absoluteTime;return this}},getNextChunk:{value:function(a){return this.chunk.id=this.readTo(4),this.chunk.id!==a?(dmaf.error("Midi Parsing: Expected",a,"but found",this.chunk.id),this):(this.chunk.length=this.read32BitInt(),this.chunk.data=this.readTo(this.chunk.length),this)}}}),{toBeatPatterns:function(a){var b=[];return h(a).forEach(function(a){b.push(a.patternId),d.set("beatPattern",a.patternId,a)}),b}}}),dmaf("beatPattern",["core","assets","_"],function(a,b,c){function d(a,d){c.extend(this,d),this.beatPattern||(this.beatPattern=b.get("beatPattern",this.patternId)),e.prototype.isPrototypeOf(this.songPosition)||(this.addAtSongPosition=a.getSongPosition(this.songPosition)),e.prototype.isPrototypeOf(this.clearPosition)||(this.clearPosition=a.getSongPosition(d.clearPosition)),this.currentBeat=a.getStartAtBeat(this.patternPosition),this.player=a,this.beatPattern||(dmaf.error("beatPatternInstance","Can't find beatPattern "+this.patternId),console.log(this),this.beatPattern=b.get("beatPattern","empty_pattern")),this.loop?(this.removeAtSongPosition=new e(1/0,1,this.player.beatsPerBar),this.currentBeat===this.loopLength&&(this.currentBeat=1)):(this.removeAtSongPosition=this.addAtSongPosition.clone(),this.removeAtSongPosition.addOffset({bar:0,beat:this.beatPattern.endPosition-this.currentBeat}))}function e(a,b,c){this.bar=void 0===a?1:a,this.beat=void 0===b?1:b,this.beatsPerBar=void 0===c?16:c}function f(a,b){this.events={},this.patternId=a,this.startPosition=b||1,this.endPosition=0}function g(a,b,c,d){this.eventName=a,this.beat=b,this.tick=c||1,this.data=d}return d.prototype.gotoNextBeat=function(){this.currentBeat++,this.loop&&this.currentBeat>this.loopLength&&(this.currentBeat=1)},d.prototype.executeEvents=function(a,b){this.beatPattern.events||console.error(this);var c=this.beatPattern.events[this.currentBeat];if(c)for(var d=0,e=c.length;e>d;d++)c[d].execute(a,b)},e.prototype.getInBeats=function(){return(this.bar-1)*this.beatsPerBar+this.beat},e.prototype.gotoNextBeat=function(){return this.beat===this.beatsPerBar?(this.bar++,this.beat=1):this.beat++,this},e.prototype.addOffset=function(a){for(this.beat+=a.beat;this.beat>this.beatsPerBar;)this.bar++,this.beat-=this.beatsPerBar;return this.bar+=a.bar,this},e.prototype.goToNextBar=function(){return this.bar++,this.beat=1,this},e.prototype.clone=function(){return new e(this.bar,this.beat,this.beatsPerBar)},f.prototype.addEvent=function(a,b,c,d){this.events[b]=this.events[b]||[],this.events[b].push(new g(a,b,c,d)),b+1>this.endPosition&&(this.endPosition=b+1)},g.prototype.execute=function(b,c){var d=Object.create(this.data);d.duration=d.duration||0,b=Math.floor(b+(this.tick-1)*(c/120)),d.duration=b+d.duration*(c/120)/1e3-b,d.duration*=1e3,a.dispatch(this.eventName,b,d)},b.set("beatPattern","empty_pattern",new f("empty_pattern")),{patternInstance:function(a,b){return new d(a,b)},pattern:function(a,b){return new f(a,b)},position:function(a,b,c){return new e(a,b,c)}}}),dmaf("sampleMap",["_"],function(a){function b(b,c){c.forEach(function(b){b.hi=a.toMidiNote(b.hi),b.low=a.toMidiNote(b.low),b.root=a.toMidiNote(b.root)}),this.name=b,this.ranges=c}return b.prototype.checkNote=function(a){return this.ranges.filter(function(b){return a>=b.low&&a<=b.hi})},b}),dmaf("actions",["core","_","instances","time","logs","dynamic","public"],function(a,b,c,d,e,f,g){function h(a){var b=a.actionProperties,c="action:"+b.type+":"+b.id,d="log:"+c,f="error:"+c;a.log=e.make(d),a.error=e.make(f)}function i(a,c){var e,g=a._dynamic;return function h(i,j,k){var p=n;n=h,j?j!==q&&(l=j||d.current,q=j):j=l=d.current,m=k,j=a.delay?l+a.delay:l,g?(e=b.clone(a),b.each(function(a,c){b.set(e,c,f.get(a))},g),c(i,j,k,e)):c(i,j,k,a),m=o,n=p}}function j(a,b,d,e){c.vivify(e)}function k(a,b,d){function e(a,b,e,f){var g=c.get(f.type,f.target);g?g[d](a,b,e,f):r.log("missing instance",f.type,f.target)}function f(a,b,d,e){c.vivify(e)}r.register(a,b,d?e:f)}var l,m,n,o,p={},q=-1;Object.defineProperty(f.registry,"eventProperties",{get:function(){return m}});var r={_:p,make:k,dispatch:function(b,c,e){return b&&"string"==typeof b?(c=c||d.current,e=e||{},void a.dispatch(b,c,e)):dmaf.error("Malformed trigger in actions.dispatch:",b)},log:function(){n?n.log.apply(n,arguments):dmaf.log.apply(null,arguments)},error:function(){n?n.error.apply(n,arguments):dmaf.error.apply(null,arguments)},register:function(a,c,d){b.set(p,[a,c],d)},get:function(a){return b.get(p,arguments.length>1?b.slice(arguments):a)},add:function(c){a.require(c.id),a.require(c.type);var d=b.get(p,[c.type,c.id])||b.get(p,[c.type,"default"])||a.require(c.id)&&j;d?(d=i(c,d),d.triggers=c.triggers,d.actionProperties=c,h(d),b.each(function(b){switch(b){case"preload_assets":case"init_routing":case"dmaf_ready":a.once(b,d);break;default:a.on(b,d)}},c.triggers)):dmaf.error("There is no valid implementation for this action "+c.id)},actionTime:function(a){return"undefined"==typeof a?l:void(l=a)}};return r}),dmaf("assets",["core","_","time"],function(a,b,c){var d={html:{},template:{},beatPattern:{},sampleMap:{},buffer:{},img:{},data:{}};return{_:d,get:function(c,e){var f=b.get(d,[c,e]);return b.isDefined(f)?f:void a.dispatch("log:error:asset","Couldn't find asset",c,e)}.autocurry(),set:function(b,e,f){return d[b]?void(d[b][e]?dmaf.log("Asset already exists:",b,e):(d[b][e]=f,a.dispatch("loaded:"+b+":"+e,c.current,f))):dmaf.error("Invalid asset type:",b)}.autocurry(),remove:function(a,b){d[a]&&d[a][b]&&delete d[a][b]}.autocurry()}}),dmaf("context",["env","core"],function(a,b){function c(a){a.proto[a.name]=a.proto[a.name]||a.shim}function d(a,b,c){return{name:a,shim:b,proto:c}}function e(a,b,c){return 1===arguments.length?this.noteOn(a):this.noteGrainOn(a,b,c)}function f(a){document.removeEventListener(a.type,f,!1);var c=b.require("context"),d=c.createBufferSource();d.buffer=c.createBuffer(1,100,44100),d.noteOn(0),b.dispatch("_internal:unlocked")}function g(a){var b=Object.getPrototypeOf(a.createBufferSource()),f=Object.getPrototypeOf(a),g=Object.getPrototypeOf(a.createGain().gain),h=!!f.createGain;return[d("createGainNode",f.createGain,f),d("createGain",f.createGainNode,f),d("createDelayNode",f.createDelay,f),d("createDelay",f.createDelayNode,f),d("createJavaScriptNode",f.createScriptProcessor,f),d("createScriptProcessor",f.createJavaScriptNode,f),d("start",e,b),d("noteOn",b.start,b),d("noteGrainOn",b.start,b),d("stop",b.noteoff,b),d("noteOff",b.stop,b)].forEach(c),a._paramProto=g,a._compliant=h,a}function h(b){return document.addEventListener(a.touch?"touchstart":"mousemove",f,!1),g(new b)}return a.webaudio&&h(window.webkitAudioContext||window.AudioContext)}),dmaf("descriptors",["_","raw_descriptors"],function(a,b){function c(a){var b=f.id(a);if(!b||!b.properties)throw"Missing descriptor";this.properties=this.properties||[],this.properties.push.apply(this.properties,b.properties)}function d(b){var d=f.id(b)||{};a.extend(this,d),d["extends"]&&a.each(c,d["extends"],this)}var e=b;d.prototype.get=function(b){return a.findWhere(this.properties,{name:b})},d.prototype.validate=function(b,c){return a.validate(this.get(b),c)},d.prototype.each=function(b,c){return a.each(b,this.properties,c)},d.prototype.defaults=function(){for(var a=this.properties,b={},c=0,d=a.length;d>c;c++)switch(a[c].type){case"string":b[a[c].name]="";break;case"array":case"list":b[a[c].name]=[];break;case"object":b[a[c].name]={};break;default:b[a[c].name]=a[c]["default"]}return b.id=this.id,b.type=this.type,b};var f={get:function(a){return new d(a)},add:function(){var b=a.slice(arguments);b.forEach(function(b){var c=!1;if(a.isString(b.type)||(console.log("didn't have type"),c=!0),a.isString(b.id)||(console.log("didn't have id"),c=!0),a.isArray(b.properties)||(console.log("properties was not an array"),c=!0),c)throw new TypeError("Invalid descriptor!\n"+JSON.stringify(b,null,4))}),e.push.apply(e,b)},create:function(a,b,c,d){e.push({valueType:a,type:b,id:c,properties:d})},id:function(b){return a.isObject(b)&&(b=b.id),a.findWhere(e,{id:b})},valueType:function(b){return a.isObject(b)&&(b=b.valueType),a.where({valueType:b},e)},isValueType:function(b,c){return a.unique(a.pluck("id",this.valueType(c))).indexOf(b)>-1},makeActionProperties:function(a){var b=f.get(a);return b?b.defaults():void dmaf.error("missing descriptor",a)}};return f}),dmaf("entity",["_","events","core","time","context","tween","descriptors","task"],function(a,b,c,d,e,f,g,h){function i(a,b,c,e,f){var g;return a.descriptor.validate(b,c)?(f=f||0,e=e||d.current,c===a[b]?(a.log("not doing transform",b,"is already",c),!0):(g=a.descriptor.get(b).type,"float"===g?n.isPrototypeOf(a[b])?k(a,b,c,f,e):f>0?l(a,b,c,f,e):m(a,b,c,e):m(a,b,c,e),!0)):(a.error("Invalid Value",c,"for",b),!1)}function j(b,c){return b&&a.isTraversable(b)?b[c]:b}function k(a,b,c,e,f){var g;f=f?.001*f:0,e=e&&e>0?.001*e:0,g=e?"linearRampToValueAtTime":"setValueAtTime",!e&&f<=.001*d.current?a[b]=c:("volume"===b&&(c=Math.max(0,Math.floor(100*Math.pow(2,c/6))/100)),a[b].cancelScheduledValues(f),a[b].setValueAtTime(a[b].value,f),a[b][g](c,e+f))}function l(b,c,d,e,g){function h(){delete b._transforms[c]}var i,j=a.get(b,["_transforms",c]);j&&j.stop(),b.log("transforming",c,"to",d,"over",e),i=new f(b,c,d,e,"linear"),a.set(b,["_transforms"],c),i.start(g,"raf"),i.oncomplete(h)}function m(b,c,e,f){var g,h=f>=d.current+d.preListen;h?(g=a.get(b,["_transforms",c]),g&&g.stop(),b.log("setting",c,"to",e,"at actionTime",f),a.set(b,["_transforms",c],{stop:d.schedule(f,function(){delete b._transforms[c],b[c]=e})})):b[c]=e}var n=e?e._paramProto:{},o=(a.joinArgs(":"),{log:a.noop,error:a.noop,critical:a.noop,init:a.noop,destroy:a.noop,construct:a.noop,trigger:c.dispatch,extend:function(){return[].reduce.call(arguments,Object.create,this)},then:function(a){return h.init(this).pipe(a)},create:function(b,c){var d=Object.create(this);return d.uid=a.uid(),d.prototype=this,c&&c(d,b),d.descriptor=g.get(b.id),d.descriptor?(d.construct(b),a.each(function(a){var c;"array"!==a.type&&"list"!==a.type?(c="undefined"!=typeof b[a.name]?b[a.name]:"string"===a.type?"":a["default"],this.set(a.name,c)):this[a.name]=b[a.name]||[]},d.descriptor.properties,d),d.init(b),d.log("created"),d):(console.error("Did not find descriptor for id:",b.id),null)},dispatchEvent:function(a,b,e){c.dispatch(a,b||d.current,e||{})},attributes:function(){var b=(a.pluck("name",this.descriptor.properties),{});return a.each(function(a){b[a]=this[a]},name,this),b},clone:function(){return this.prototype.create(this.attributes())},get:function(b){return a.toKeys(b).reduce(j,this)},set:function(b,c,d,e){var f,g,h,j=b;if(b=a.toKeys(b),f=b.pop(),g=h=this,b.length)for(;b.length;){if(h=h[b.shift()],!h)return this.error(b.join(":"),"is undefined"),!1;o.isPrototypeOf(h)&&(g=h)}return g===h?i(g,f,c,d,e):g.id&&"string"==typeof c?void a.set(g,j,c):(this.error("Can't set property inside list or array"),!1)}});return o}),dmaf("instances",["entity","dynamic","_","logs","core","time"],function(a,b,c,d,e,f){function g(a,b){var c=b.type+":"+b.instanceId,f="log:instance:"+c,g="error:instance:"+c;(dmaf.dev||"undefined"==typeof window)&&(a.log=d.make(f),a.error=d.make(g)),a.critical=function(){console.error.apply(console,arguments),e.dispatch("dmaf_fail")}}function h(a,d){c.set(this,d,b.get(a))}function i(a,d){c.set(this,d,b.get(a))}var j=b.registry,k=c.each(h),l=c.each(i);return{get:function(a){var a=arguments.length>1?c.slice(arguments):c.toKeys(a),b=c.get(j,a.slice(0,2));return b&&a.length<=2?b:b?b.get(a.slice(2)):void 0},set:function(a,b,d,e){var a=c.toKeys(a),f=c.get(j,a.slice(0,2));return f?f.set(a.slice(2),b,d,e):void 0},create:function(a){var b,d=e.require(a.id),f=c.clone(a);return d?(f._dynamic&&k(f._dynamic,f),c.get(j,[f.type,f.instanceId])?(dmaf.error("Duplicate instance",b),null):(b=d.create(f,g),c.set(j,[f.type,f.instanceId],b),b)):(dmaf.error("Missing instance prototype",a.type,a.id),null)},remove:function(a){var a,b,d;return arguments.length>1&&(a=c.slice(arguments)),a=c.toKeys(a),b=a[0],d=a[1],j[b]?j[b][d]?(j[b][d].destroy(),delete j[b][d]):!1:(dmaf.error("Invalid instance type",b),!1)},vivify:function(a){var b=a.type,d=a.instanceId,e=c.get(j,[b,d]);return e?a._dynamic&&l(a._dynamic,e):e=this.create(a),e},getInstances:function(){return j},registry:j}}),dmaf("time",["context","_","core","env","visibility"],function f(a,b,c,d,e){function g(){t=!0}function h(){s=window.requestAnimationFrame}function i(){s=j}function j(a){return setTimeout(a,17)}function k(){return t?Math.floor(1e3*a.currentTime):Date.now()-p}function l(){var a=0,b=q.length;if(b)for(setTimeout(l,f.preListen),o=f.current;b>a&&q[a];a++)q[a](o)}function m(){var a=0,b=r.length;if(b)for(window.requestAnimationFrame(m),o=f.current;b>a&&r[a];a++)r[a](o)}function n(a,b,c){this.pending=[],"string"==typeof b&&(b=a[b]),this.preListen="undefined"==typeof c?f.preListen:c,this.f=b.apply.bind(b,a),this.valueOf=function(){return this.pending.length}}var o,f=Object.create(null,{current:{
get:k},ticking:{get:function(){return!!q.length}},animating:{get:function(){return!!r.length}}}),p=Date.now(),q=[],r=[],s=d.web?window.requestAnimationFrame:setTimeout,t=!1;return d.web&&(e.onhidden(i),e.onvisible(h),c.once("_internal:unlocked",g)),f.preListen=c.preListen||30,n.prototype.cancel=function(){for(;this.pending.length;)clearTimeout(this.pending.shift())},n.prototype.schedule=function(a){var c=this.f.bind(null,b.slice(arguments,1));o=f.current,a>=o+this.preListen?this.pending.push(setTimeout(c,a-o-this.preListen)):c()},f.clearDelay=clearTimeout,f.schedule=function(a,c,d){var e,g=b.slice(arguments,3);return d=void 0===d?f.preListen:d,o=f.current,a>=o+d?(e=setTimeout(c.apply.bind(c,this,g),a-o-d),function(){return clearTimeout(e)}):(c.apply(this,g),b.noop)},f.addTicker=function(a,c,d){if(q.filter(b.propIs("id",a)).shift())return void dmaf.error("Tick listener",a,"is already running");var e=c.bind(d),f=!q.length;e.id=a,q.push(e),f&&l()},f.removeTicker=function(a){q=q.filter(b.propIsnt("id",a))},f.addFrameListener=function(a,c,d){if(r.filter(b.propIs("id",a)).shift())return void dmaf.error("error:time","Frame listener",a,"is already running");var e=c.bind(d||null),f=!r.length;e.id=a,r.push(e),f&&m()},f.removeFrameListener=function(a){r=r.filter(b.propIsnt("id",a))},f.createScheduler=function(a,b,c){return new n(a,b,c)},f.init=function(){a&&a.currentTime>0&&(t=!0,c.off("_internal:unlocked"))},d.web||(f.addFrameListener=f.removeFrameListener=b.noop),f}),dmaf("assetController",["actions","entity","async","core","_","assets","instances","env"],function(a,b,c,d,e,f,g,h){function i(a,b,c,d,e){g.vivify(d).load(a)}function j(a,b,c,d){g.vivify(d).unload()}return a.register("assetController","default",i),a.register("assetController","unload",j),b.extend({type:{value:"assetController"},basePath:{get:function(){return d.assetsPath+this.assetLocation}},load:{value:function(a){this.log("started"),this.files.length?c.each(this.files,this.iterator.bind(this),this.oncomplete(this,a)):this.oncomplete(this,a)(null)}},oncomplete:{value:function(a,b){return function(c){c&&a.error(c),a.log("complete"),a.returnEvent&&d.dispatch(a.returnEvent),"preload_assets"===b&&d.dispatch("_internal:preload_complete")}}},unload:{value:function(){this.files&&this.files.forEach(f.remove.bind(f,this.assetType))}}})}),dmaf("dynamic",["_","core","time"],function(a,b,c){function d(a,b,c,d,e,f){return b.replace(RegExp(c),d||"").replace(h,"")}var e=Object.create(null,{currentTime:{get:function(){return Math.floor(c.current)}},multi:{get:function(){return b.getCurrentEvent()}},asset:{get:function(){return b.require("assets")._}},projectData:{get:function(){return b.projectData}},core:{get:function(){return b}}}),f={},g=/\/([^\/]+)\/([^\/]+)\/([^\/]*)\//g,h=/\.$/;return f.get=function(c){return"multi"===c?b.getCurrentEvent():a.isString(c)&&/\/multi\//.test(c)?c.replace(/multi/g,b.getCurrentEvent()).replace(g,d):a.get(f.registry,a.toKeys(c))},f.registry=e,f}),dmaf("public",["core","_","instances","time"],function(a,b,c,d){function e(b){return function(){return a.active?b.apply(dmaf,arguments):dmaf}}function f(c,d){function e(a){c.apply(null,a)}var f=a.pending[d];dmaf[d]=c,b.each(e,f),delete a.pending[d]}var g={},h={listeners:{once:e(function(b,c){return a.once("_external:"+b,c),dmaf}),addEventListener:e(function(b,c){return a.addEventListener("_external:"+b,c),dmaf}),removeEventListener:e(function(b,c){return a.removeEventListener("_external:"+b,c),dmaf}),unregisterObject:e(function(b){return a.dispatch("log:public:unregisterObject",b),delete g[b],c.get("customCode",b)&&c.remove("customCode",b),a.dispatch(b+".REMOVE"),dmaf}),fail:function(c){return a.once("dmaf_fail",function(){c.apply(dmaf,b.slice(arguments,1))}),dmaf},ready:e(function(c){return a.once("dmaf_ready",function(){c.apply(dmaf,b.slice(arguments,1))}),dmaf})},input:{tell:e(function(b,c,e){return dmaf.logEvents&&console.log("dmaf.tell:",b),a.dispatch("log:public:tell",b,c),a.dispatch(b,e||d.current,c),dmaf}),registerObject:e(function(b,c){if(a.dispatch("log:public:registerObject",b,c),"string"!=typeof b||"object"!=typeof c)throw new TypeError("dmaf.registerObject: invalid type. Please use signature:\n dmaf.registerObject(string, object);");if(g[b])throw new TypeError("dmaf.registerObject: Object with id "+b+" has already been registered. Please call dmaf.unregisterObject(id) first.");return g[b]=c,a.dispatch(b+".CREATE",d.current,{id:b,obj:c}),dmaf})}};return dmaf.toString=function(){return""},dmaf("registeredObjects",g),{resolve:b.compose(b.each(f),b.get(h))}}),dmaf("tween",["_","time","env"],function(a,b,c){function d(a){j.push(a)}function e(a){k.push(a)}function f(a){for(var b=0;b<j.length;b++)j[b].update(a)||j.splice(b,1)}function g(a){for(var b=0;b<k.length;b++)k[b](a)||k.splice(b,1)}function h(f,g,h,l,m){var n,o,p=[],q=[];l=l||0,this.start=function(h,i){function l(){for(p.stop=m,o=p.startTime=h,n=1*f[g],(i&&c.web?d:e)(p);q.length;)q.shift().call(f)}function m(){var a=i?j:k;a.splice(a.indexOf(this),1)}var p=this;this.start=a.noop,this.stop=b.schedule(h,l,0)},this.update=function(){var c,d,e=b.current;if(c=(e-o)/l,c>1&&(c=1),d=i[m](c),f[g]=n+(h-n)*d,1===c){for(this.stop=a.noop;p.length;)p.shift().call(f);return!1}return!0}.bind(this),this.oncomplete=function(b){a.isFunction(b)&&p.push(b)},this.onstart=function(b){a.isFunction(b)&&q.push(b)}}var i={linear:function(a){return a}},j=[],k=[];return b.addFrameListener("tween_raf",f),b.addTicker("tween_tick",g),h}),dmaf("visibility",["core","env"],function(a,b){function c(){clearTimeout(k),h(c),k=setTimeout(d,100),e(!0)}function d(){e(!1)}function e(a){g!==a&&(g=a,(g?i:j).forEach(f))}function f(a){return a()}if(b.web){var g,h=window.requestAnimationFrame,i=[],j=[],k=null;return b.web&&c(),{onvisible:function(a){i.push(a)},onhidden:function(a){j.push(a)}}}}),dmaf("staticLoader",["descriptors","actions","instances","entity","task","async","core","_","env","context","assets","midiParser","sampleMap","time","beatPattern"],function g(a,b,c,d,e,f,h,i,j,k,l,m,n,o,p){function q(a,b){b.lengthComputable&&(i.set(this.progressHash,[a.type,a.name],b.loaded),this.dispatchProgress())}function g(a,b,d,e){c.vivify(e).load(a,b,d)}function r(a){return y[a]}function s(a){var b,c={};if(x(a))if(b=u.exec(a))switch(c.name=b[2],c.type=b[1],c.url=h.assetsPath,/\//.test(c.name)&&(c.url+=c.name.replace(v,"")+"/",c.name=w(c.name)),c.type){case"audio":case"midi":case"html":case"template":case"css":c.url+=c.type+"/"+c.name+r(c.type);break;case"png":case"jpg":case"gif":c.url+="img/"+c.name+"."+c.type,c.type="img";break;case"json":case"sampleMap":c.url+="json/"+c.name+r(c.type);break;default:this.error("Invalid file type",c.type)}else this.error("malfomed asset path string",a);else this.error("Invalid item in files list"),c=null;return c}function t(a){var b=a._files.length,c=0;return function(a){var d;return d=parseInt(++c/b*100),this.dispatchEvent(this.instanceId+":progress",0,{value:d}),a}.bind(a)}var u=/^([\w@]+)\/\/([\w@\/]+)/,v=/\/([^\/]+)$/,w=i.firstMatch(v),x=i.test(u),y={midi:".mid",audio:j.audioFormat,html:".html",sampleMap:".json",json:".json",image:".png",template:".template",css:".css"};return b.register("assetController","staticLoader",g),d.extend({type:{value:"assetController"},id:{value:"staticLoader"},loading:{get:function(){return this._loading},set:function(a){this._loading=a}},init:{value:function(a){this.progressHash={}}},load:{value:function(a){function b(a,b){function e(){d.log(a.type,a.name,"complete")}switch(b=i.compose(b,e,c),a.type){case"audioBinary":this.loadAudioBinary(a,b);break;case"audio":this.loadAudio(a,b);break;case"midi":this.loadMidi(a,b);break;case"html":this.loadHtml(a,b);break;case"sampleMap":this.loadSampleMap(a,b);break;case"json":this.loadJson(a,b);break;case"img":this.loadImage(a,b);break;default:console.error("Invalid Type",a.type)}}if(this.loading)return void this.log("loading is already in progress");if(this.loaded)return this.log("loading has already completed. dispatching complete"),this.oncomplete(this,a)();this.loading=!0;var c=t(this),d=this;f.each(this._files,b.bind(this),this.oncomplete(this,a))}},dispatchProgress:{value:function(){function a(a){b+=a}{var b=0,c=0;i.each(a)}i.each(function(a){i.each(function(a){b+=a},a)},this.progressHash),c=parseInt(b/this.totalSize*100),this.dispatchEvent(this.instanceId+":progress",o.current,{value:c,bytesLoaded:b,bytesTotal:this.totalSize,percent:c})}},oncomplete:{value:function(a,b){return function(c){c&&a.error(c),a.log("setting loading false"),a.loading=!1,a.loaded=!0,a.log("complete"),a.dispatchEvent(a.instanceId+":complete"),"preload_assets"===b&&h.dispatch("_internal:preload_complete")}}},files:{get:function(){return this._files},set:function(a){var b=0;this.compiled?(a.forEach(function(a){a.url=h.assetsPath+a.path,"audioBinary"===a.type&&(a.url+=j.audioFormat+".bin",a.size=".ogg"===j.audioFormat?a.size.ogg:a.size.aac),b+=a.size}),this.totalSize=b,this._files=a):this._files=a.map(s,this).filter(i.truthy)}},loadAudioBinary:{value:function(a,b){function c(c,e){c?b(c):f.each(a.files,d.bind(this,e),b)}function d(a,b,c){function d(a){l.set("buffer",b.name,a),c(null)}function e(a){c("Error decoding binary data: "+b.name)}var f=a.slice(b[g].start,b[g].end);k.decodeAudioData(f,d,e)}if(!j.webaudio)return b(new Error("Browser does not support web audio"));var e=i.getArrayBuffer(a.url,c.bind(this)),g=j.audioFormat.replace(/\./,"");e.onprogress=q.bind(this,a)}},loadAudio:{value:function(a,b){function c(c,f){c?b("Could not get arrayBuffer "+a.url):k.decodeAudioData(f,d,e)}function d(c){l.set("buffer",a.name,c),b(null)}function e(){b("Could not decode audio data "+a.url)}return j.webaudio?void i.getArrayBuffer(a.url,c):b(new Error("Browser does not support web audio"))}},loadMidi:{value:function(a,b){function c(c,d){c?b("Could not get "+a.url):(a.result=m.toBeatPatterns(d),b(null))}var d=i.getMIDI(a.url,c);this.compiled&&(d.onprogress=q.bind(this,a))}},loadHtml:{value:function(a,b){function c(c,d){c?b("Could not get "+a.url):(l.set("html",a.name,d),b(null))}var d=i.getDocument(a.url,c);this.compiled&&(d.onprogress=q.bind(this,a))}},loadSampleMap:{value:function(a,b){function c(a,b){l.set("sampleMap",b,new n(b,a))}function d(a,d){a?b("Could not load samplemap "+name):(i.each(c,d),b(null))}var e=i.getJSON(a.url,d);this.compiled&&(e.onprogress=q.bind(this,a))}},loadJson:{value:function(a,b){function c(c,f){c?b("Could not load json "+name):(d(f)?e(f):l.set("data",a.name,f),b(null))}function d(a){var b=JSON.stringify(a);return/patternId/gm.test(b)&&!/framerate/gm.test(b)}function e(a){function b(a){var b=p.pattern(a.patternId,a.startPosition);i.each(function(a,c){a.forEach(function(a){b.addEvent(a.eventName,a.beat,a.tick,a.data)})},a.events),l.set("beatPattern",a.patternId,b)}i.each(b,a)}var f=i.getJSON(a.url,c);this.compiled&&(f.onprogress=q.bind(this,a))}},loadImage:{value:function(a,b){function c(c,d){c?b("Could not load image "+name):(this.compiled&&(i.set(this.progressHash,[a.type,a.name],a.size),this.dispatchProgress()),l.set("img",a.name,d),b(null))}i.getImg(a.url,c.bind(this))}},_loaded:{get:function(){function a(a){switch(a.type){case"audioBinary":return;case"audio":return b("buffer",a.name);case"midi":return c(a);case"json":return b("data",a.name)}}function b(a,b){return!!l.get(a,b)}function c(a){return a.result.every(b("beatPattern"))}var b=b.autoCurry();return this.files.every(a)}}})}),dmaf("environmentController",["entity","_","env"],function(a,b,c){return a.extend({type:{value:"control"},id:{value:"environmentController"},init:{value:function(a){var d,e=!1,f=this;b.each(function(a){return b.each(function(g){if(g.OS.length){if(d=new RegExp(g.OS.join("|")),!d.test(c.OS))return b["break"];f.log("passed test",d.toString())}if(g.formFactor.length){if(d=new RegExp(g.formFactor.join("|")),!d.test(c.device))return b["break"];f.log("passed test",d.toString())}return g.browser.length?(b.each(function(d){var g=d.split(/\s/),h=g[0],i=g[1],j=parseFloat(g[2]),k=parseFloat(c.version);if(c.browser===h)if(i){if(b[i](k,j))return e=!0,f.log("Found match!",d),f.dispatchEvent(a.dispatch),b["break"]}else if(c.browser===h)return e=!0,f.log("Found match!",d),f.dispatchEvent(a.dispatch),b["break"]},g.browser),e?b["break"]:void 0):(e=!0,f.dispatchEvent(a.dispatch),b["break"])},a.conditions),e?b["break"]:void 0},this.initEvents),!e&&this.fallbackEvent&&(this.log("No matches found. Dispatching fallback event",this.fallbackEvent),this.dispatchEvent(this.fallbackEvent))}}})}),dmaf("eventMapper",["entity","core","actions","instances","_","time"],function(a,b,c,d,e,f){function g(a,b,c,e){d.vivify(e).execute(a,b,c)}return c.register("eventProcessor","eventMapper",g),a.extend({type:{value:"eventProcessor"},id:{value:"eventMapper"},init:{value:function(){this.lastEvent="",this.lastExecutedTime=-1,this.pending=f.createScheduler(this,this.send,f.preListen)}},send:{value:function(a,c,d){"ALWAYS"===this.dispatch||a!==this.lastEvent?(this.log("dispatching",a,c),b.dispatch.apply(null,arguments),this.lastEvent=a):this.log("onChange settings prevented dispatching of",a)}},execute:{value:function(a,b,c){var d;f.current-this.lastExecutedTime>=this.reTrig?(d=e.find(e.is(a)),this.clearPending&&(this.log("Clearing Pending",a),this.pending.cancel()),this.eventMaps.forEach(function(a){var e=d(a["in"]);e&&e!==a.out&&(a.delay||(a.delay=0),this.log("Scheduling",b,a.out,b+a.delay),this.pending.schedule(b+a.delay,a.out,b+a.delay,c))},this),this.lastExecutedTime=f.current):this.log("Retrig prevented execution.")}}})}),dmaf("splash",["core","assets","entity","descriptors","logs","instances","actions","_","ajax","env","time"],function h(a,b,c,d,e,f,g,i,j,k,l){function h(a,b,c,d){f.vivify(d)}function m(a,b,c,d){var e=f.get("control",d.target);e&&e.hide()}function n(c,d,e){try{var f=b.get("img",d);f?c.style.backgroundImage="url('"+b.get("img",d).src+"')":i.getImg(a.assetsPath+"img/"+d+"."+e,function(a,e){b.set("img",d,e),c.style.backgroundImage="url('"+b.get("img",d).src+"')"})}catch(g){console.log("adblocker blocked",d)}}function o(a,b){a.addEventListener("transitionend",b),a.addEventListener("webkitTransitionEnd",b)}return d.add({type:"control",id:"splash","extends":[],properties:[{name:"instanceId",type:"string"},{name:"triggers",type:"list"}]}),g.register("control","splash",h),d.add({type:"control",id:"hideSplash","extends":[],properties:[{name:"instanceId",type:"string"},{name:"target",type:"string"},{name:"triggers",type:"list"}]}),g.register("control","hideSplash",m),c.extend({type:{value:"control"},id:{value:"splash"},log:{value:e.make("log:instance:splash")},error:{value:e.make("error:instance:splash")},init:{value:function(){this.splash=document.getElementById("splash"),this.container=document.getElementById("container"),this.btn=document.getElementById("slideshow-start-btn"),n(this.splash,"bg","jpg"),this.splash.style.opacity=1,this.btn.style.display="none"}},hide:{value:function(){function a(){this.splash.style.opacity<.1&&(this.splash.style.display="none",this.btn.style.display="block",this.log("splash hidden"))}this.log("hiding splash"),o(this.splash,a.bind(this)),this.container.style.visibility="visible",this.splash.style.opacity=0}}})}),dmaf("waitForAll",["core","assets","entity","descriptors","logs","instances","actions","_","ajax","env","time"],function i(a,b,c,d,e,f,g,h,j,k,l){function i(a,b,c,d){f.vivify(d).onEvent(a,b,c,d)}function m(a,b){var c=a.split(":");return h.filter(function(a){var b=a.split(":");if(b.length>c.length)return!1;for(var d=0;d<b.length;d++)if(b[d]!==c[d])return!1;return!0},b)}return g.register("control","waitForAll",i),d.add({type:"control",id:"waitForAll","extends":[],properties:[{name:"instanceId",type:"string"},{name:"dispatchOnAll",type:"list"},{name:"triggers",type:"list"}]}),c.extend({type:{value:"control"},id:{value:"waitForAll"},log:{value:e.make("log:instance:waitForAll")},error:{value:e.make("error:instance:waitForAll")},init:{value:function(){this.haveFired={},this.hasCompleted=!1,h.each(function(a){this.haveFired[a]=!1},this.triggers,this)}},onEvent:{value:function(b,c,d,e){this.hasCompleted||(h.each(function(a){this.haveFired[a]=!0},m(b,this.triggers),this),h.every(h.is(!0),this.haveFired)&&(h.each(function(b){this.log("dispatching:",b),a.dispatch(b)},this.dispatchOnAll,this),this.log("dispatching:",this.instanceId+":complete"),a.dispatch(this.instaceId+":complete"),this.hasCompleted=!0))}}})}),dmaf("slideLoader",["core","assets","entity","descriptors","logs","instances","actions","_","ajax","env","time"],function j(a,b,c,d,e,f,g,h,i,k,l){function j(a,b,c,d){f.vivify(d).load(a,b,c,d)}return g.register("custom","slideLoader",j),d.add({type:"custom",id:"slideLoader","extends":[],properties:[{name:"instanceId",type:"string"},{name:"numberOfSlides",type:"int",min:0,max:999999999,"default":0},{name:"imgType",type:"string"},{name:"triggers",type:"list"}]}),c.extend({type:{value:"custom"},id:{value:"slideLoader"},log:{value:e.make("log:instance:slideLoader")},error:{value:e.make("error:instance:slideLoader")},init:{value:function(){this.complete=!1,this.numberLoaded=0}},load:{value:function(c,d,e,f){if(!this.complete){var g=a.assetsPath+"/img/"+c+"."+this.imgType,i=this;this.log("fetching",c,"at",g),h.getImg(g,function(d,e){null!==d?(a.dispatch(i.instanceId+":failed"),i.error(d)):(b.set("img",c,e),i.numberLoaded++,i.log("loaded slides count",i.numberLoaded),i.numberLoaded>=i.numberOfSlides&&(i.complete=!0,a.dispatch(i.instanceId+":complete")))})}}}})}),dmaf("mainController",["core","assets","entity","descriptors","logs","instances","actions","_","ajax","env"],function k(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d){f.vivify(d).onevent(a,b,c)}function l(c,d,e){try{var f=b.get("img",d);f?c.style.backgroundImage="url('"+b.get("img",d).src+"')":h.getImg(a.assetsPath+"img/"+d+"."+e,function(a,e){b.set("img",d,e);try{c.style.backgroundImage="url('"+b.get("img",d).src+"')"}catch(a){console.log("adblocker blocked",d)}})}catch(g){console.log("adblocker blocked",d)}}function m(a){var b=window.open(a,"share","height=315, width=415");window.focus&&b.focus()}function n(a,b){a.removeEventListener("transitionend",b),a.removeEventListener("webkitTransitionEnd",b)}function o(a){a.className+=" no-hover"}function p(a){a.className+=" force-hover"}function q(){this.hoverEls.map(function(a){a.className=a.className.replace("no-hover","")})}function r(){this.hoverEls.map(function(a){a.className=a.className.replace("force-hover","")})}var s=1,t=2,u=1,v=2,w="jpg";return void 0===window.gapi&&(window.gapi={interactivepost:{render:h.noop}}),g.register("control","mainController",k),d.add({type:"control",id:"mainController","extends":[],properties:[{name:"instanceId",type:"string"},{name:"nextImg",type:"string"},{name:"backImg",type:"string"},{name:"brandImg",type:"string"},{name:"splashImg",type:"string"},{name:"headerImg",type:"string"},{name:"fbImg",type:"string"},{name:"twImg",type:"string"},{name:"gpImg",type:"string"},{name:"items",type:"list"},{name:"triggers",type:"list"}]}),c.extend({type:{value:"controller"},id:{value:"mainController"},log:{value:e.make("log:instance:main_controller")},error:{value:e.make("error:instance:main_controller")},init:{value:function(){if(this.container=document.getElementById("container"),this.splash=document.getElementById("splash"),this.header=document.getElementById("header"),this.headerLeftContainer=document.getElementById("header-left-container"),this.headerMiddleContainer=document.getElementById("header-middle-container"),this.headerRightContainer=document.getElementById("header-right-container"),this.headerBrand=document.getElementById("header-brand"),this.headerAppIcon=document.getElementById("header-app-icon"),this.headerShare=document.getElementById("header-share"),this.headerShareFb=document.getElementById("header-share-fb"),this.headerShareTw=document.getElementById("header-share-tw"),this.headerShareGp=document.getElementById("header-share-gp"),this.headerBackIcon=document.getElementById("header-back-icon"),this.headerBackBtn=document.getElementById("header-back-btn"),this.headerNextIcon=document.getElementById("header-next-icon"),this.headerNextBtn=document.getElementById("header-next-btn"),this.slideshow=document.getElementById("slideshow"),this.slideshowImgContainer=document.getElementById("slideshow-img-container"),this.slideshowImg1=document.getElementById("slideshow-img-1"),this.slideshowImg2=document.getElementById("slideshow-img-2"),this.slideshowBackBtn=document.getElementById("slideshow-back-btn"),this.slideshowNextBtn=document.getElementById("slideshow-next-btn"),this.slideshowStartBtn=document.getElementById("slideshow-start-btn"),this.slideshowStartBtnInner=document.getElementById("slideshow-start-btn-inner"),this.app=document.getElementById("app"),this.appDismiss=document.getElementById("app-dismiss"),this.index=0,this.state=s,this.iframe=null,this.inProgress=!1,this.stepping=!1,this.activeSlide=this.slideshowImg1,this.inactiveSlide=this.slideshowImg2,l(this.header,this.headerImg),l(this.headerBrand,this.brandImg),l(this.headerShareFb,this.fbImg),l(this.headerShareTw,this.twImg),l(this.headerShareGp,this.gpImg),l(this.headerBackBtn,this.backImg),l(this.headerNextBtn,this.nextImg),l(this.slideshowBackBtn,this.backImg),l(this.slideshowNextBtn,this.nextImg),this.slideshowBackBtn.addEventListener("click",this.step.bind(this,v)),this.slideshowNextBtn.addEventListener("click",this.step.bind(this,u)),this.headerLeftContainer.addEventListener("click",this.step.bind(this,v)),this.headerRightContainer.addEventListener("click",this.step.bind(this,u)),this.hoverEls=[this.slideshowBackBtn,this.slideshowNextBtn,this.headerLeftContainer,this.headerRightContainer,this.headerShareFb,this.headerShareTw,this.headerShareGp,this.slideshowStartBtn],this.addHoverListeners=function(a){a.addEventListener("touchstart",q.bind(this)),a.addEventListener("touchstart",p.bind(this,a)),a.addEventListener("touchend",o.bind(null,a)),a.addEventListener("touchend",r.bind(this))}.bind(this),j.desktop||this.hoverEls.map(this.addHoverListeners),""!==window.location.hash){var a=window.location.hash.replace("#","");this.overrideApp=a.split("-")[0],this.overrideUrl=a.split("-")[1],(void 0===this.overrideApp||void 0===this.overrideUrl)&&(this.overrideApp=void 0,this.overrideUrl=void 0)}this.slideshowStartBtn.onclick=function(){ga("send","event","start-"+this.currentItem.hash,"user-action"),this.state=t}.bind(this),this.appDismiss.onclick=function(){this.state=s}.bind(this),this.swapSlides=function(){var a=this.activeSlide;this.activeSlide=this.inactiveSlide,this.inactiveSlide=a,this.inactiveSlide.style.backgroundImage="",n(this.inactiveSlide,this.swapSlides),n(this.activeSlide,this.swapSlides),this.inProgress=!1}.bind(this),this.destroyApp=function(){this.app.removeChild(this.iframe),this.iframe=null,this.app.style.display="none",n(this.slideshow,this.destroyApp)}.bind(this),this.locationChange(),window.addEventListener("popstate",this.locationChange.bind(this)),this.initPortalShareIcons()}},locationChange:{value:function(){var a,b=/\/\/[^\/]*\/([^\/\#]*)/.exec(window.location.href);this.inProgress=!0,b.length>1&&(a=h.find(h.propIs("hash",b[1]),this.items)),a||(a=this.items[0],history.pushState(null,null,this.items[0].hash)),ga("send","pageview","/"+a.hash),this.index=this.items.indexOf(a),this.prepareStartButton(this.currentItem),this.setSlideImage(a),this.setAppIcons(),this.activeSlide.style.opacity=0,this.inactiveSlide.style.opacity=1,this.activeSlide.addEventListener("transitionend",this.swapSlides),this.state=s}},setLocation:{value:function(a){history.pushState(null,null,"/"+a),this.locationChange()}},prepareStartButton:{value:function(){this.overrideApp===this.currentItem.hash&&void 0!==this.currentItem.altButtonText?this.slideshowStartBtn.firstChild.textContent=this.currentItem.altButtonText:this.slideshowStartBtnInner.textContent="START"}},currentItem:{get:function(){return this.items[this.index]}},state:{get:function(){return this._state},set:function(a){return this._state=a,j.desktop?void(this._state===t?(this.setAppIcons(),this.slideshow.style.transform="translateY(100%)",this.slideshow.style.webkitTransform="translateY(100%)",this.app.style.display="block",this.loadApp()):this._state===s&&(this.setAppIcons(),this.slideshow.style.transform="translateY(0%)",this.slideshow.style.webkitTransform="translateY(0%)",this.iframe&&(this.slideshow.removeEventListener("transitionend",this.destroyApp),this.slideshow.addEventListener("transitionend",this.destroyApp)))):void(this._state===t&&this.loadApp())}},setSlideImage:{value:function(a){void 0===b.get("img",a.slide)?(l(this.inactiveSlide,a.slide+"_error",w),this.slideshowStartBtn.style.visibility="hidden"):a.comingSoon?(l(this.inactiveSlide,a.slide,w),this.slideshowStartBtn.style.visibility="hidden"):(l(this.inactiveSlide,a.slide,w),this.slideshowStartBtn.style.visibility="visible")}},loadApp:{value:function(){ga("send","event","load-"+this.currentItem.hash,"user-action"),null!==this.iframe&&void 0!==this.iframe&&(this.app.removeChild(this.iframe),this.iframe=null),j.desktop?(this.iframe=document.createElement("iframe"),this.iframe.src=this.overrideApp===this.currentItem.hash?this.overrideUrl:this.currentItem.appUrl,this.iframe.height=this.currentItem.iframeMinHeight&&this.currentItem.iframeMinHeight>this.app.clientHeight?this.currentItem.iframeMinHeight:this.currentItem.iframeHeight,this.app.appendChild(this.iframe)):window.open(this.overrideApp===this.currentItem.hash?this.iframe.src:this.currentItem.appUrl)}},setAppIcons:{value:function(){var a=this.index+1,b=this.index-1;a=this.constrainIndex(a),b=this.constrainIndex(b),l(this.headerBackIcon,this.items[b].headerSmall),l(this.headerAppIcon,this.currentItem.headerTall),l(this.headerNextIcon,this.items[a].headerSmall),this.headerBackIcon.className="header-icon glow "+this.items[b].hash+"-icon",this.headerNextIcon.className="header-icon glow "+this.items[a].hash+"-icon"}},step:{value:function(a){if(!this.inProgress){this.inProgress=!0,this.stepping=!0;var b=this.currentItem;a===u?this.index++:this.index--,this.index=this.constrainIndex(this.index),this.state===s?ga("send","event","browse-"+b.hash+"-to-"+this.currentItem.hash,"user-action"):this.state===t&&(ga("send","event","app-"+b.hash+"-to-"+this.currentItem.hash,"user-action"),this.state=s),this.setLocation(this.currentItem.hash),this.stepping=!1}}},initPortalShareIcons:{value:function(){var a="http://dinahmoelabs.com",b="Im at Dinahmoe Labs playing cool musical games, try them yourself at ",c="709283741222-t6r4o2gphq7s9unhcl889c3m210qc2df.apps.googleusercontent.com";this.headerShareTw.onclick=function(){var c="http://twitter.com/share?";c+="url="+a,c+="&text="+b,c+="&source=webclient",m(c)}.bind(this),this.headerShareFb.onclick=m.bind(this,"https://www.facebook.com/sharer/sharer.php?u="+a),void 0!==gapi&&gapi.interactivepost.render("header-share-gp",{contenturl:a,clientid:c,prefilltext:b+a,cookiepolicy:"single_host_origin",calltoactionlabel:"CREATE",calltoactionurl:a}),j.desktop||(this.addHoverListeners(this.headerShareGp),this.headerShareGp.addEventListener("touchstart",function(){this.className="share-btn"}))}},constrainIndex:{value:function(a){for(;0>a;)a+=this.items.length;return a%=this.items.length}}})}),dmaf("mobile",["core","env"],function(a,b){if(!b.desktop){var c,d=function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet}();console.log("adding rotate css"),c="",c+="@media all and (orientation:portrait) {",c+="    /* show the rotate screen */",c+="    #rotate-device {",c+="        display: block;",c+="    }   ",c+="}",d.insertRule(c),c="",c+="@media all and (orientation:landscape) {",c+="    /* hide the rotate screen */",c+="    #rotate-device {",c+="        display: none;",c+="    }   ",c+="}",d.insertRule(c),c="",c+="#rotate-device {",c+="    position: absolute;",c+="    z-index: 100;",c+="    width: 100vw;",c+="    height: 100vh;",c+='    background-image: url("http://a6c2ddd44eeb424bbd81-387f99874fb8448921e210828b10137d.r13.cf5.rackcdn.com/img/rotate_device.jpg");',c+="    background-size: cover;",c+="    background-position: center center;",c+="    display: none;",c+="}",d.insertRule(c);var e=document.createElement("div");e.id="rotate-device",document.body.insertBefore(e,document.body.firstChild)}});
