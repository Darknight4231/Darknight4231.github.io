<!DOCTYPE html>
<head>
  <style>

    #WaveVer {
      padding: 1em;
      margin: 1em;
      color: white;
      background-color: black;
    }
    #WaveVer:hover{
      background-color: grey;
    }

    .ranges{
      clear: both;
      float: left;
    }
    .ranges:hover{
      background-color: black;
    }
    .rangelabel{
      float: left;
      position: relative;
    }

    button{
      padding: 2em;
      margin: 2em;
      float:left;
      clear: both;
    }

  </style>
</head>


<body>
"A440 is widely used as concert pitch in the United Kingdom and the United States. In continental Europe the frequency of A4 commonly varies between 440 Hz and 444 Hz. In the period instrument movement, a consensus has arisen around a modern baroque pitch of 415 Hz (with 440 Hz corresponding to A♯), a 'baroque' pitch for some special church music (in particular, some German church music, e.g. the Pre-Leipzig period cantatas of Bach) known as (Chorton pitch) at 466 Hz (with 440 Hz corresponding to A♭), and classical pitch at 430 Hz."
  <button type="button" id="Start" name="Start">Start oscillator</button>
  <button type="button" id="END" name="ENDbutton">END  Please note that if you press this, you will need to refresh the webpage in order to restart the oscillator at this time.</button>

  <input type="range" class="ranges" id="Volume" value="0" min="0" max="100"> <label class="rangelabel" for="Volume">Volume</label>
  <input type="range" class="ranges" id="Freq" value="100" min="0" max="480" step="5"><label class="rangelabel" for="Freq">Frequency</label><p>Frequency is currently <p id="freqvaltxt">440</p>

  <select id="WaveVer" name="waveAAH">
    <option value="sin">Sin</option>
    <option value="square">Square</option>
    <option value="triangle">Triangle</option>
    <option value="sawtooth">Sawtooth</option>
  </select>

<p>Frequency Values with Triangle wavetype sound similar to old arcade games.</p>

<input type="file" name="fileinput" value=""><label for="fileinput">Does nothing for now.</label>
<script>
//from https://alligator.io/js/first-steps-web-audio-api/
//https://ipinfo.info/html/ip_checker.php finds the real ip address, can be used for DNS server things

//setValueAtTime(value, Time)
//setTargetAtTime(value, Time, timeconstant (rate of change ;P) )

//gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0)

/*let musicContext = new AudioContext({
  latencyHint: "playback",
  sampleRate: 48000
});
*/

//audioContext.createMediaElementSource(mediaElement) fires from HTML media (audio/video) element
// ^^^ https://webaudio.github.io/web-audio-api/#mediaelementaudiosourcenode
let audioContext;

try {
  audioContext =
    new (window.AudioContext || window.webkitAudioContext)();
    console.log("AudioContext Defined, starting.");
} catch (error) {
  console.log("AudioContext startup unsuccessful");
  window.alert(
    `Sorry, but your browser doesn't support the Web Audio API!`
  );
}

if (audioContext !== undefined) {
  /* Our code goes here */

  let OSCON = 0;

  const Gainvalue = document.getElementById("Volume");
  const Frequ = document.getElementById("Freq");
  const freqtxt = document.getElementById("freqvaltxt");
  const WaveVer = document.getElementById("WaveVer");

  const StartDoc = document.getElementById("Start");
  StartDoc.addEventListener('click', Start);
  const END = document.getElementById("END");
  END.addEventListener('click', End);

  const gainNode = audioContext.createGain();
  const gainNode2 = console.log("GainNode created");

  const oscillator = audioContext.createOscillator();
  const oscillator2 = console.log("Oscillator created");

  const OscConnect = oscillator.connect(gainNode);
  const OscConnect2 = console.log("oscillator connected to GainNode");

  const GainConnect = gainNode.connect(audioContext.destination);
  const GainConnect2 = console.log("GainNode connected to audioContext.destination");

  //event listener for gain rangebar changes.
  Gainvalue.onchange = function(){
    gainchange(Gainvalue.value);
  };
  //event listener for Frequency rangebar changes.
  Frequ.onchange = function(){
    Freqchange();
  };

  //Event listener for Wavetype selection changes.
  WaveVer.onchange = function(){
      oscillator.type = WaveVer.value;
  };
    //function to change frequency of oscillator. Dependant on event listener input.
    function Freqchange(){
     oscillator.frequency.setValueAtTime(Frequ.value, audioContext.currentTime);
     freqtxt.innerHTML = Frequ.value;
    };
    //function to change volume of Gain node. Dependant on event listener input.
    function gainchange(e) {
      gainNode.gain.setValueAtTime(e/100, audioContext.currentTime);
    };

//This function is what Starts and stops the whole thing. Until the start button is first pressed, nothing will be on but gainNodes at the most.
  function Start() {
    //This first IF statement starts the oscillator if it hasn't been started already.
    if (OSCON == 0){
    oscillator.start();
    oscillator2;
    OscConnect;
    OscConnect2;
    OSCON = 1;
    console.log("oscillator Started");
   }
   if (StartDoc.innerHTML == "Start oscillator") {
     //unmute function
     gainNode.gain.setValueAtTime(1, audioContext.currentTime);
     console.log("Gain on");
     StartDoc.innerHTML ="Stop";

   } else if (StartDoc.innerHTML =="Stop") {
     //mute function
     gainNode.gain.setValueAtTime(0, audioContext.currentTime);
     console.log("Gain muted");
     StartDoc.innerHTML = "Start oscillator";
   }
  };

  function End(){
    //Once stopped, a new oscillator has to be created. You cannot restart an oscillator.
    oscillator.stop();
    console.log("Ended Oscillator, no sounds are produced.");
  };

  console.log("Finished Setup.");
};
</script>
</body>
